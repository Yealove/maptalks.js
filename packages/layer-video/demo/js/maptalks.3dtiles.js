!function(t){"function"==typeof define&&define.amd?define(["maptalks"],t):t()}(function(){"use strict";var r;function t(t,n){r?n(maptalks,maptalks,maptalksgl):(maptalks.registerWorkerAdapter("@maptalks/3dtiles",n),r=!0)}t(0,function(t){var n="undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};var r,i=(function(t){!function(a){var u,o,f="fulfilled",s="undefined",h=function(){var n=[],r=0;function i(){for(;n.length-r;){try{n[r]()}catch(t){a.console&&a.console.error(t)}n[r++]=o,1024==r&&(n.splice(0,1024),r=0)}}var e=function(){if(typeof MutationObserver===s)return typeof process!==s&&"function"==typeof process.nextTick?function(){process.nextTick(i)}:typeof setImmediate!==s?function(){setImmediate(i)}:function(){setTimeout(i,0)};var t=document.createElement("div");return new MutationObserver(i).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}();return function(t){n.push(t),n.length-r==1&&e()}}();function c(t){if(!(this instanceof c))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof t){var n=this;try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+t+" is not a function")}function v(t,n){if("function"==typeof t.y)try{var r=t.y.call(o,n);t.p.resolve(r)}catch(n){t.p.reject(n)}else t.p.resolve(n)}function l(t,n){if("function"==typeof t.n)try{var r=t.n.call(o,n);t.p.resolve(r)}catch(n){t.p.reject(n)}else t.p.reject(n)}c.prototype={resolve:function(r){if(this.state===u){if(r===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var i=this;if(r&&("function"==typeof r||"object"==typeof r))try{var n=!0,t=r.then;if("function"==typeof t)return void t.call(r,function(t){n&&(n=!1,i.resolve(t))},function(t){n&&(n=!1,i.reject(t))})}catch(t){return void(n&&this.reject(t))}this.state=f,this.v=r,i.c&&h(function(){for(var t=0,n=i.c.length;t<n;t++)v(i.c[t],r)})}},reject:function(r){if(this.state===u){var t=this;this.state="rejected",this.v=r;var i=this.c;h(i?function(){for(var t=0,n=i.length;t<n;t++)l(i[t],r)}:function(){t.handled||!c.suppressUncaughtRejectionError&&a.console&&c.warn("You upset Zousan. Please catch rejections: ",r,r?r.stack:null)})}},then:function(t,n){var r=new c,i={y:t,n:n,p:r};if(this.state===u)this.c?this.c.push(i):this.c=[i];else{var e=this.state,a=this.v;this.handled=!0,h(function(){e===f?v(i,a):l(i,a)})}return r},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,i){i=i||"Timeout";var e=this;return new c(function(n,r){setTimeout(function(){r(Error(i))},t),e.then(function(t){n(t)},function(t){r(t)})})}},c.resolve=function(t){var n=new c;return n.resolve(t),n},c.reject=function(t){var n=new c;return n.c=[],n.reject(t),n},c.all=function(r){var i=[],e=0,a=new c;function t(t,n){t&&"function"==typeof t.then||(t=c.resolve(t)),t.then(function(t){i[n]=t,++e==r.length&&a.resolve(i)},function(t){a.reject(t)})}for(var n=0;n<r.length;n++)t(r[n],n);return r.length||a.resolve(i),a},c.warn=console.warn,t.exports&&(t.exports=c),a.define&&a.define.amd&&a.define([],function(){return c}),(a.Zousan=c).soon=h}(n)}(r={exports:{}},r.exports),r.exports),m=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array,s=Math.random;function e(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function u(t){var n=t[0],r=t[1],i=t[2];return Math.sqrt(n*n+r*r+i*i)}function o(t,n,r){var i=new a(3);return i[0]=t,i[1]=n,i[2]=r,i}function I(t,n,r,i){return t[0]=n,t[1]=r,t[2]=i,t}function p(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function f(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t}function h(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t}function c(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t}function N(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t}function v(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2];return Math.sqrt(r*r+i*i+e*e)}function l(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2];return r*r+i*i+e*e}function d(t){var n=t[0],r=t[1],i=t[2];return n*n+r*r+i*i}function M(t,n){var r=n[0],i=n[1],e=n[2],a=r*r+i*i+e*e;return 0<a&&(a=1/Math.sqrt(a),t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a),t}function w(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function y(t,n,r){var i=n[0],e=n[1],a=n[2],u=r[0],o=r[1],f=r[2];return t[0]=e*f-a*o,t[1]=a*u-i*f,t[2]=i*o-e*u,t}function T(t,n,r){var i=n[0],e=n[1],a=n[2],u=r[3]*i+r[7]*e+r[11]*a+r[15];return u=u||1,t[0]=(r[0]*i+r[4]*e+r[8]*a+r[12])/u,t[1]=(r[1]*i+r[5]*e+r[9]*a+r[13])/u,t[2]=(r[2]*i+r[6]*e+r[10]*a+r[14])/u,t}var b,g=f,A=h,E=c,x=v,_=l,C=u,L=d,O=(b=e(),function(t,n,r,i,e,a){var u=void 0,o=void 0;for(n||(n=3),r||(r=0),o=i?Math.min(i*n+r,t.length):t.length,u=r;u<o;u+=n)b[0]=t[u],b[1]=t[u+1],b[2]=t[u+2],e(b,b,a),t[u]=b[0],t[u+1]=b[1],t[u+2]=b[2];return t}),S=Object.freeze({__proto__:null,create:e,clone:function(t){var n=new a(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},length:u,fromValues:o,copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},set:I,add:p,subtract:f,multiply:h,divide:c,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t},min:function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t},max:function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t},scale:N,scaleAndAdd:function(t,n,r,i){return t[0]=n[0]+r[0]*i,t[1]=n[1]+r[1]*i,t[2]=n[2]+r[2]*i,t},distance:v,squaredDistance:l,squaredLength:d,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t},normalize:M,dot:w,cross:y,lerp:function(t,n,r,i){var e=n[0],a=n[1],u=n[2];return t[0]=e+i*(r[0]-e),t[1]=a+i*(r[1]-a),t[2]=u+i*(r[2]-u),t},hermite:function(t,n,r,i,e,a){var u=a*a,o=u*(2*a-3)+1,f=u*(a-2)+a,s=u*(a-1),h=u*(3-2*a);return t[0]=n[0]*o+r[0]*f+i[0]*s+e[0]*h,t[1]=n[1]*o+r[1]*f+i[1]*s+e[1]*h,t[2]=n[2]*o+r[2]*f+i[2]*s+e[2]*h,t},bezier:function(t,n,r,i,e,a){var u=1-a,o=u*u,f=a*a,s=o*u,h=3*a*o,c=3*f*u,v=f*a;return t[0]=n[0]*s+r[0]*h+i[0]*c+e[0]*v,t[1]=n[1]*s+r[1]*h+i[1]*c+e[1]*v,t[2]=n[2]*s+r[2]*h+i[2]*c+e[2]*v,t},random:function(t,n){n=n||1;var r=2*s()*Math.PI,i=2*s()-1,e=Math.sqrt(1-i*i)*n;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t[2]=i*n,t},transformMat4:T,transformMat3:function(t,n,r){var i=n[0],e=n[1],a=n[2];return t[0]=i*r[0]+e*r[3]+a*r[6],t[1]=i*r[1]+e*r[4]+a*r[7],t[2]=i*r[2]+e*r[5]+a*r[8],t},transformQuat:function(t,n,r){var i=r[0],e=r[1],a=r[2],u=r[3],o=n[0],f=n[1],s=n[2],h=e*s-a*f,c=a*o-i*s,v=i*f-e*o,l=e*v-a*c,d=a*h-i*v,M=i*c-e*h,w=2*u;return h*=w,c*=w,v*=w,l*=2,d*=2,M*=2,t[0]=o+h+l,t[1]=f+c+d,t[2]=s+v+M,t},rotateX:function(t,n,r,i){var e=[],a=[];return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],a[0]=e[0],a[1]=e[1]*Math.cos(i)-e[2]*Math.sin(i),a[2]=e[1]*Math.sin(i)+e[2]*Math.cos(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateY:function(t,n,r,i){var e=[],a=[];return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],a[0]=e[2]*Math.sin(i)+e[0]*Math.cos(i),a[1]=e[1],a[2]=e[2]*Math.cos(i)-e[0]*Math.sin(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateZ:function(t,n,r,i){var e=[],a=[];return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],a[0]=e[0]*Math.cos(i)-e[1]*Math.sin(i),a[1]=e[0]*Math.sin(i)+e[1]*Math.cos(i),a[2]=e[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},angle:function(t,n){var r=o(t[0],t[1],t[2]),i=o(n[0],n[1],n[2]);M(r,r),M(i,i);var e=w(r,i);return 1<e?0:e<-1?Math.PI:Math.acos(e)},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},equals:function(t,n){var r=t[0],i=t[1],e=t[2],a=n[0],u=n[1],o=n[2];return Math.abs(r-a)<=m*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=m*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(e-o)<=m*Math.max(1,Math.abs(e),Math.abs(o))},sub:g,mul:A,div:E,dist:x,sqrDist:_,len:C,sqrLen:L,forEach:O});function U(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function R(t,n,r,i,e){return t[0]=n,t[1]=r,t[2]=i,t[3]=e,t}function j(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t}function k(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t[3]=n[3]*r[3],t}function F(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t[3]=n[3]/r[3],t}function P(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2],a=n[3]-t[3];return Math.sqrt(r*r+i*i+e*e+a*a)}function X(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2],a=n[3]-t[3];return r*r+i*i+e*e+a*a}function D(t){var n=t[0],r=t[1],i=t[2],e=t[3];return Math.sqrt(n*n+r*r+i*i+e*e)}function q(t){var n=t[0],r=t[1],i=t[2],e=t[3];return n*n+r*r+i*i+e*e}function V(t,n){var r=n[0],i=n[1],e=n[2],a=n[3],u=r*r+i*i+e*e+a*a;return 0<u&&(u=1/Math.sqrt(u),t[0]=r*u,t[1]=i*u,t[2]=e*u,t[3]=a*u),t}var B,z=j,G=k,Z=F,H=P,J=X,Y=D,Q=q,K=(B=U(),function(t,n,r,i,e,a){var u=void 0,o=void 0;for(n||(n=4),r||(r=0),o=i?Math.min(i*n+r,t.length):t.length,u=r;u<o;u+=n)B[0]=t[u],B[1]=t[u+1],B[2]=t[u+2],B[3]=t[u+3],e(B,B,a),t[u]=B[0],t[u+1]=B[1],t[u+2]=B[2],t[u+3]=B[3];return t}),W=Object.freeze({__proto__:null,create:U,clone:function(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},fromValues:function(t,n,r,i){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},set:R,add:function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t},subtract:j,multiply:k,divide:F,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t},min:function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t[3]=Math.min(n[3],r[3]),t},max:function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t[3]=Math.max(n[3],r[3]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t},scale:function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t},scaleAndAdd:function(t,n,r,i){return t[0]=n[0]+r[0]*i,t[1]=n[1]+r[1]*i,t[2]=n[2]+r[2]*i,t[3]=n[3]+r[3]*i,t},distance:P,squaredDistance:X,length:D,squaredLength:q,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t},normalize:V,dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},lerp:function(t,n,r,i){var e=n[0],a=n[1],u=n[2],o=n[3];return t[0]=e+i*(r[0]-e),t[1]=a+i*(r[1]-a),t[2]=u+i*(r[2]-u),t[3]=o+i*(r[3]-o),t},random:function(t,n){var r,i,e,a,u,o;for(n=n||1;1<=(u=(r=2*s()-1)*r+(i=2*s()-1)*i););for(;1<=(o=(e=2*s()-1)*e+(a=2*s()-1)*a););var f=Math.sqrt((1-u)/o);return t[0]=n*r,t[1]=n*i,t[2]=n*e*f,t[3]=n*a*f,t},transformMat4:function(t,n,r){var i=n[0],e=n[1],a=n[2],u=n[3];return t[0]=r[0]*i+r[4]*e+r[8]*a+r[12]*u,t[1]=r[1]*i+r[5]*e+r[9]*a+r[13]*u,t[2]=r[2]*i+r[6]*e+r[10]*a+r[14]*u,t[3]=r[3]*i+r[7]*e+r[11]*a+r[15]*u,t},transformQuat:function(t,n,r){var i=n[0],e=n[1],a=n[2],u=r[0],o=r[1],f=r[2],s=r[3],h=s*i+o*a-f*e,c=s*e+f*i-u*a,v=s*a+u*e-o*i,l=-u*i-o*e-f*a;return t[0]=h*s+l*-u+c*-f-v*-o,t[1]=c*s+l*-o+v*-u-h*-f,t[2]=v*s+l*-f+h*-o-c*-u,t[3]=n[3],t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},equals:function(t,n){var r=t[0],i=t[1],e=t[2],a=t[3],u=n[0],o=n[1],f=n[2],s=n[3];return Math.abs(r-u)<=m*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-o)<=m*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(e-f)<=m*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(a-s)<=m*Math.max(1,Math.abs(a),Math.abs(s))},sub:z,mul:G,div:Z,dist:H,sqrDist:J,len:Y,sqrLen:Q,forEach:K});function $(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function tt(t,n,r,i){var e=n[0],a=n[1],u=n[2],o=n[3],f=r[0],s=r[1],h=r[2],c=r[3],v=void 0,l=void 0,d=void 0,M=void 0,w=void 0;return(l=e*f+a*s+u*h+o*c)<0&&(l=-l,f=-f,s=-s,h=-h,c=-c),w=m<1-l?(v=Math.acos(l),d=Math.sin(v),M=Math.sin((1-i)*v)/d,Math.sin(i*v)/d):(M=1-i,i),t[0]=M*e+w*f,t[1]=M*a+w*s,t[2]=M*u+w*h,t[3]=M*o+w*c,t}var nt,rt,it,et,at,ut,ot,ft=V;nt=e(),rt=o(1,0,0),it=o(0,1,0),et=$(),at=$(),ut=new a(9),a!=Float32Array&&(ut[1]=0,ut[2]=0,ut[3]=0,ut[5]=0,ut[6]=0,ut[7]=0),ut[0]=1,ut[4]=1,ut[8]=1,ot=ut;st=new a(2),a!=Float32Array&&(st[0]=0,st[1]=0),ht=st;var st,ht,ct="undefined"!=typeof Promise?Promise:i,vt={get:function(n,e){var a=vt.t(),t=new ct(function(r,i){if(a.open("GET",n,!0),e){for(var t in e.headers)a.setRequestHeader(t,e.headers[t]);a.withCredentials="include"===e.credentials,e.responseType&&(a.responseType=e.responseType)}a.onreadystatechange=vt.r(a,function(t,n){t?i(t):r(n)}),a.send(null)});return t.xhr=a,t},r:function(t,n){return function(){if(4===t.readyState)if(200===t.status)"arraybuffer"===t.responseType?0===t.response.byteLength?n(new Error("http status 200 returned without content.")):n(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):n(null,t.responseText);else{if(0===t.status)return;n(new Error(t.statusText+","+t.status))}}},t:function(){var n;try{n=new XMLHttpRequest}catch(t){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}}return n},getArrayBuffer:function(t,n){return n||(n={}),n.responseType="arraybuffer",vt.get(t,n)}};function lt(t){return null==t}function dt(t){return!lt(t)}function Mt(t){return"number"==typeof t&&isFinite(t)}function wt(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var i in r)t[i]=r[i]}return t}function mt(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}vt.getJSON=function(t,n){var r=vt.get(t,n),i=r.then(function(t){return t?JSON.parse(t):null});return i.xhr=r.xhr,i};var pt=function(){function t(t,n){this.rootPath=t,this.gltf=n}var n=t.prototype;return n.iterate=function(t,n){var r=this.gltf[n];if(r){var i=0;for(var e in r)t(e,r[e],i++)}},n.createNode=function(t,n){var r={};return dt(t.name)&&(r.name=t.name),dt(t.children)&&(r.children=t.children),dt(t.jointName)&&(r.jointName=t.jointName),dt(t.matrix)&&(r.matrix=t.matrix),dt(t.rotation)&&(r.rotation=t.rotation),dt(t.scale)&&(r.scale=t.scale),dt(t.translation)&&(r.translation=t.translation),dt(t.extras)&&(r.extras=t.extras),dt(t.meshes)&&(r.meshes=t.meshes.map(function(t){return n[t]})),r},n.getBaseColorTexture=function(t){var n,r,i=this.gltf.materials[t];if(void 0===(r=i.instanceTechnique&&i.instanceTechnique.values?(n=i.instanceTechnique).values.diffuse:(n=i).values.tex||n.values.diffuseTex||n.values.diffuse)||void 0===this.gltf.textures)return null;var e=this.gltf.textures[r];if(!e)return null;var a=this.gltf.samplers[e.sampler];return{format:e.format||6408,internalFormat:e.internalFormat||6408,type:e.type||5121,sampler:a,source:this.gltf.images[e.source]}},n.getMaterial=function(){return null},n.getAnimations=function(){return null},t}(),yt=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],bt=function(){function t(t,n,r,i){this.rootPath=t,this.gltf=n,this.glbBuffer=r,this.buffers={},this.requests={},this.ignoreGLBOffset=i}var n=t.prototype;return n.i=function(r,i){var e=this,t=this.gltf,n=t.accessors[i],a=t.bufferViews[n.bufferView],u=t.buffers[a.buffer];if("binary_glTF"!==a.buffer&&"KHR_binary_glTF"!==a.buffer&&u.uri){var o=u.uri,f=0===u.uri.indexOf("data:application/")?u.uri:this.rootPath+"/"+o;return this.requests[f]?this.requests[f].then(function(){return e.e(r,i,e.buffers[f])}):this.requests[f]=vt.getArrayBuffer(f,null).then(function(t){var n=t.data;return e.buffers[f]=n,e.e(r,i,n)})}var s=this.e(r,i,this.glbBuffer.buffer,this.ignoreGLBOffset?0:this.glbBuffer.byteOffset);return ct.resolve(s)},n.e=function(t,n,r,i){void 0===i&&(i=0);var e=this.gltf,a=e.accessors[n],u=e.bufferViews[a.bufferView],o=(u.byteOffset||0)+i,f=this.a(a.type),s=mt(a.componentType),h=s.BYTES_PER_ELEMENT,c=u.byteStride||0;c===h*f&&(c=0);var v={array:void 0,name:t,accessorName:n,bufferView:a.bufferView,byteOffset:c&&a.byteOffset||0,byteStride:c,byteLength:a.count*f*s.BYTES_PER_ELEMENT,componentType:a.componentType,count:a.count,type:a.type,itemSize:f};if(a.min&&(v.min=a.min),a.max&&(v.max=a.max),0===c){var l=o+(a.byteOffset||0);l%s.BYTES_PER_ELEMENT!=0&&(console.warn(t+"'s bytes is not aligned"),r=r.slice(o,o+a.count*f*s.BYTES_PER_ELEMENT),l=0),delete v.bufferView,v.array=new s(r,l,f*a.count)}else v.array=new Uint8Array(r,o,u.byteLength);return v},n.a=function(t){var n=yt.indexOf(t);return yt[n+1]},t}(),gt=function(){function t(t,n,r,i){this.rootPath=t,this.gltf=n,this.glbBuffer=r,this.buffers={},this.requests={},this.u=i,this.accessor=new bt(t,n,r)}var n=t.prototype;return n.iterate=function(t,n){var r=this.gltf[n];if(r)for(var i=0;i<r.length;i++)t(i,r[i],i)},n.createNode=function(t,n,r){var i={};return wt(i,t),dt(t.mesh)&&(i.meshes=[n[t.mesh]]),dt(t.skin)&&(i.skin=r[t.skin],i.skinIndex=t.skin),!dt(t.weights)&&i.meshes?i.weights=i.meshes[0].weights:i.weights=t.weights,i},n.getMaterial=function(t){var e=this.gltf.materials[t],n=e.pbrMetallicRoughness,r=e.normalTexture,i=e.occlusionTexture,a=e.emissiveTexture,u=e.extensions,o=[];if(n&&(n.name="pbrMetallicRoughness",o.push(this.o(n,["baseColorTexture","metallicRoughnessTexture"]))),r&&o.push(this.f(r,"normalTexture")),i&&o.push(this.f(i,"occlusionTexture")),a&&o.push(this.f(a,"emissiveTexture")),u){var f=u.KHR_materials_pbrSpecularGlossiness;f&&(f.name="pbrSpecularGlossiness",o.push(this.o(f,["diffuseTexture","specularGlossinessTexture"])))}return ct.all(o).then(function(t){var n={};wt(n,e);for(var r=0;r<t.length;r++)n[t[r].name]=t[r];if(n.extensions){var i=n.extensions.KHR_materials_unlit;i&&(n.unlit=i),delete n.extensions}return{material:n}})},n.o=function(i,t){for(var n=[],r=0;r<t.length;r++){var e=i[t[r]];e&&n.push(this.f(e,t[r]))}return ct.all(n).then(function(t){var n={};wt(n,i);for(var r=0;r<t.length;r++)delete t[r].index,n[t[r].name]=t[r];return n})},n.f=function(r,t){var n=r.index,i=r.extensions;return dt(n)?(i&&i.KHR_texture_transform&&(r.KHR_texture_transform={},wt(r.KHR_texture_transform,i.KHR_texture_transform),delete r.extensions),r.name=t,this.s(n).then(function(t){var n={texture:t};return wt(n,r),delete n.index,n})):null},n.s=function(t){var i=this,e=this.gltf.textures[t];if(!e)return null;var a=this.gltf.images[e.source];return this.h(a).then(function(t){var n={image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:a.mimeType,name:a.name,extensions:a.extensions,extras:a.extras}};wt(n,e),delete n.sampler;var r=dt(e.sampler)?i.gltf.samplers[e.sampler]:void 0;return r&&(n.sampler=r),n})},n.h=function(t){if(!dt(t.bufferView)){var n=t.uri,r=0===n.indexOf("data:image/")?n:this.rootPath+"/"+n;return this.l(r)}var i=this.gltf.bufferViews[t.bufferView];if(this.buffers[t.bufferView])return ct.resolve(this.buffers[t.bufferView]);var e=this.gltf.buffers[i.buffer];return e.uri?this.d(e.uri,i,t):this.glbBuffer?this.M(i,t):null},n.l=function(t){var n=this;return this.requests[t]?this.requests[t].then(function(){return n.buffers[t]}):this.requests[t]=this.w(t,t)},n.d=function(t,a,u){var o=this,f=u.bufferView;return this.requests[t]?this.requests[t].then(function(){return o.buffers[f]}):vt.getArrayBuffer(t,null).then(function(t){var n=t.data,r=o.m(a,n),i=new Blob([r],{type:u.mimeType}),e=URL.createObjectURL(i);return o.w(f,e)})},n.M=function(t,n){var r=this.m(t,this.glbBuffer.buffer),i=new Blob([r],{type:n.mimeType}),e=URL.createObjectURL(i);return this.w(n.bufferView,e)},n.w=function(e,t){var a=this;return new ct(function(r,i){a.u(t,function(t,n){t?i(t):(a.buffers[e]=n,r(a.buffers[e]))})})},n.m=function(t,n,r){r=r||0;var i=t.byteOffset+r,e=t.byteLength;return n.slice(i,i+e)},n.b=function(t,n){for(var r=new Array(t.byteLength),i=0;i<t.byteLength;i++)r[i]=String.fromCharCode(t[i]);return r.join(""),"data:"+(n=n||"image/png")+";base64,"+window.btoa(unescape(encodeURIComponent(r)))},n.getAnimations=function(r){var n=this,i=[];return r.forEach(function(t){i.push(n.getSamplers(t.samplers))}),ct.all(i).then(function(t){for(var n=0;n<t.length;n++)r[n].samplers=t[n];return r})},n.getSamplers=function(r){for(var t=[],n=0;n<r.length;n++)(dt(r[n].input)||dt(r[n].output))&&(t.push(this.accessor.i("input",r[n].input)),t.push(this.accessor.i("output",r[n].output)));return ct.all(t).then(function(t){for(var n=0;n<t.length/2;n++)r[n].input=t[2*n],r[n].output=t[2*n+1],r[n].interpolation||(r[n].interpolation="LINEAR");return r})},t}(),Tt="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null,At=1313821514,Et=5130562,xt=function(){function e(){}return e.read=function(t,n){void 0===n&&(n=0);var r=new DataView(t,n),i=r.getUint32(4,!0);if(1===i)return e.readV1(r,n);if(2===i)return e.readV2(t,n);throw new Error("Unsupported glb version : "+i)},e.readV1=function(t,n){var r=t.getUint32(8,!0),i=t.getUint32(12,!0);if(r!==t.buffer.byteLength-n)throw new Error("Length in GLB header is inconsistent with glb's byte length.");var e=_t(t.buffer,20+n,i);return{json:JSON.parse(e),glbBuffer:{byteOffset:20+n+i,buffer:t.buffer}}},e.readV2=function(t,n){for(var r,i,e=new DataView(t,n+12),a=0;a<e.byteLength;){var u=e.getUint32(a,!0);a+=4;var o=e.getUint32(a,!0);if(a+=4,o===At)r=_t(t,n+12+a,u);else if(o===Et){var f=n+12+a;i=t.slice(f,f+u)}a+=u}return{json:JSON.parse(r),glbBuffer:{byteOffset:n,buffer:i}}},e}();function _t(t,n,r){if(Tt){var i=new Uint8Array(t,n,r);return Tt.decode(i)}return function(t){for(var n=t.length,r="",i=0;i<n;){var e=t[i++];if(128&e){var a=Ct[e>>3&7];if(!(64&e)||!a||n<i+a)return null;for(e&=63>>a;0<a;a-=1){var u=t[i++];if(128!=(192&u))return null;e=e<<6|63&u}}r+=String.fromCharCode(e)}return r}(new Uint8Array(t,n,r))}var Ct=[1,1,1,1,2,2,3,0],It=[0,0,0],Lt=[0,0,0,1],Ot=[1,1,1],Nt=[0,0,0],St=[0,0,0,1],Ut=[1,1,1],Rt={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},jt={g:function(t,n,r,i,e,a,u){for(var o=t.animations,f=0;f<o.length;f++)for(var s=o[f],h=s.channels,c=0;c<h.length;c++){var v=h[c];v.target.node===n&&("translation"===v.target.path?this.T(i,s.samplers[v.sampler],r,1):"rotation"===v.target.path?this.A(e,s.samplers[v.sampler],r,1):"scale"===v.target.path?this.T(a,s.samplers[v.sampler],r,1):"weights"===v.target.path&&u&&this.T(u,s.samplers[v.sampler],r,u.length))}},T:function(t,n,r,i){switch(n.interpolation){case"LINEAR":var e=this._(Rt,n,r,1*i);e&&(t=function(t,n,r,i){for(var e=0;e<t.length;e++)t[e]=n[e]+i*(r[e]-n[e]);return t}(t,e.PREVIOUS,e.NEXT,e.INTERPOLATION));break;case"STEP":var a=this._(Rt,n,r,1*i);a&&(t=function(t,n){for(var r=0;r<t.length;r++)t[r]=n[r];return t}.apply(void 0,[t].concat(a.PREVIOUS)));break;case"CUBICSPLINE":var u=this._(Rt,n,r,3*i);u&&(t=this.C(t,u,n.input.array,3*i))}return t},A:function(t,n,r){switch(n.interpolation){case"LINEAR":var i=this._(Rt,n,r,1);i&&tt(t,i.PREVIOUS,i.NEXT,i.INTERPOLATION);break;case"STEP":var e=this._(Rt,n,r,1);e&&(t=R.apply(W,[t].concat(e.PREVIOUS)));break;case"CUBICSPLINE":var a=this._(Rt,n,r,3);if(a){for(var u=0;u<a.PREVIOUS.length;u++)a.PREVIOUS[u]=Math.acos(a.PREVIOUS[u]),a.NEXT[u]=Math.acos(a.NEXT[u]);t=this.C(t,a,n.input.array,3);for(var o=0;o<t.length;o++)t[o]=Math.cos(t[o])}}return t},_:function(t,n,r,i){var e,a,u,o=n.input.array,f=n.output.array,s=n.output.itemSize;(r<o[0]||r>o[o.length-1])&&(r=Math.max(o[0],Math.min(o[o.length-1],r))),r===o[o.length-1]&&(r=o[0]);for(var h=0;h<o.length-1;h++)if(r>=o[h]&&r<o[h+1]){var c=o[h];u=(r-c)/(o[a=(e=h)+1]-c);break}if(!a)return null;t.PREINDEX=e,t.NEXTINDEX=a,t.INTERPOLATION=u;var v=s*i;return t.PREVIOUS=f.subarray(t.PREINDEX*v,(t.PREINDEX+1)*v),t.NEXT=f.subarray(t.NEXTINDEX*v,(t.NEXTINDEX+1)*v),t},C:function(t,n,r,i){for(var e=n.INTERPOLATION,a=r[n.PREINDEX],u=r[n.NEXTINDEX],o=0;o<3;o++){var f=n.PREVIOUS[i+o],s=(u-a)*n.PREVIOUS[2*i+o],h=n.NEXT[3+o],c=(u-a)*n.NEXT[o],v=(2*Math.pow(e,3)-3*Math.pow(e,2)+1)*f+(Math.pow(e,3)-2*Math.pow(e,2)+e)*s+(2*-Math.pow(e,3)+3*Math.pow(e,2))*h+(Math.pow(e,3)-Math.pow(e,2))*c;t[o]=v}return t},getAnimationClip:function(t,n,r,i){var e,a,u,o,f,s,h,c,v,l,d,M,w,m,p,y,b,g,T,A,E,x,_,C=n.nodes[r]&&n.nodes[r].weights;I.apply(S,[It].concat(Nt)),R.apply(W,[Lt].concat(St)),I.apply(S,[Ot].concat(Ut)),this.g(n,r,i,It,Lt,Ot,C),e=t,u=It,o=Ot,f=(a=Lt)[0],s=a[1],h=a[2],c=a[3],M=f*(v=f+f),w=f*(l=s+s),m=f*(d=h+h),p=s*l,y=s*d,b=h*d,g=c*v,T=c*l,A=c*d,E=o[0],x=o[1],_=o[2],e[0]=(1-(p+b))*E,e[1]=(w+A)*E,e[2]=(m-T)*E,e[3]=0,e[4]=(w-A)*x,e[5]=(1-(M+b))*x,e[6]=(y+g)*x,e[7]=0,e[8]=(m+T)*_,e[9]=(y-g)*_,e[10]=(1-(M+p))*_,e[11]=0,e[12]=u[0],e[13]=u[1],e[14]=u[2],e[15]=1},getTimeSpan:function(t){if(!t.animations)return null;var a=-1/0,u=1/0;return t.animations.forEach(function(t){for(var n=t.channels,r=0;r<n.length;r++){var i=n[r],e=t.samplers[i.sampler].input.array;e[e.length-1]>a&&(a=e[e.length-1]),e[0]<u&&(u=e[0])}}),{max:a,min:u}}},kt="undefined"==typeof document?null:document.createElement("canvas"),Ft=function(){function t(t,n,r){if(this.options=r||{},n.buffer instanceof ArrayBuffer){var i=xt.read(n.buffer,n.byteOffset),e=i.json,a=i.glbBuffer;this.I(t,e,a)}else this.I(t,n)}var n=t.prototype;return n.load=function(){var t=this.L(),n=this.O();return ct.all([t,n]).then(function(t){return t[0].animations=t[1],t[0]})},t.getAnimationClip=function(t,n,r,i){return jt.getAnimationClip(t,n,r,i)},t.getAnimationTimeSpan=function(t){return jt.getTimeSpan(t)},t.getTypedArrayCtor=function(t){return mt(t)},n.I=function(t,n,r){this.gltf=n,this.version=n.asset?+n.asset.version:1,this.rootPath=t,this.glbBuffer=r,this.buffers={},this.requests={},this.options.requestImage=this.options.requestImage||Pt,2===this.version?(this.accessor=new bt(t,n,r,!0),this.adapter=new gt(t,n,r,this.options.requestImage)):(this.accessor=new bt(t,n,r),this.adapter=new pt(t,n))},n.N=function(t,r){var n,i=this;if(t.children&&0<t.children.length){if(!Mt(t.children[0])&&(lt(n=t.children[0])||"string"!=typeof n&&(null===n.constructor||n.constructor!==String)))return t;var e=t.children.map(function(t){var n=r[t];return n.nodeIndex=t,i.N(n,r)});t.children=e}if(dt(t.skin)){var a=t.skin.joints;if(a&&a.length&&Mt(a[0])){var u=t.skin.joints.map(function(t){return r[t]});t.skin.joints=u}}return t},n.L=function(){var o=this;return this.S().then(function(e){var a,u=o.scenes=[];for(var t in e)e[t]=o.N(e[t],e),e[t].nodeIndex=Number(t)?Number(t):t;o.adapter.iterate(function(t,n,r){var i={};n.name&&(i.name=n.name),n.nodes&&(i.nodes=n.nodes.map(function(t){return e[t]})),o.gltf.scene===t&&(a=r),u.push(i)},"scenes");var n={scene:a,scenes:u,nodes:e,meshes:o.meshes,skins:o.skins};return o.gltf.extensions&&(n.extensions=o.gltf.extensions),n})},n.S=function(){var e=this;return this.U().then(function(){var i=e.nodes={};return e.adapter.iterate(function(t,n){var r=e.adapter.createNode(n,e.meshes,e.skins);i[t]=r},"nodes"),i})},n.R=function(){var i=this;this.skins={};var e=[];return this.adapter.iterate(function(n,t,r){e.push(i.j(t).then(function(t){t.index=r,i.skins[n]=t}))},"skins"),e},n.j=function(n){var t=n.inverseBindMatrices;return this.accessor.i("inverseBindMatrices",t).then(function(t){return n.inverseBindMatrices=t,n})},n.O=function(){var t=this.gltf.animations;return dt(t)?this.adapter.getAnimations(t):null},n.U=function(){var i=this;this.meshes={};var e=[];return this.adapter.iterate(function(n,t,r){e.push(i.k(t).then(function(t){t.index=r,i.meshes[n]=t}))},"meshes"),e=e.concat(this.R()),ct.all(e)},n.k=function(r){var n=this,t=r.primitives.map(function(t){return n.F(t)});return ct.all(t).then(function(t){var n={};return wt(n,r),n.primitives=t,n})},n.F=function(i){var e=this,t=[],n=i.attributes,r=this.P(i);r&&t.push(r);var a=null;for(var u in n){var o=this.accessor.i(u,n[u]);o&&t.push(o)}if(dt(i.indices)){var f=this.accessor.i("indices",i.indices);f&&t.push(f)}if(dt(i.targets))for(var s=0;s<i.targets.length;s++){var h=i.targets[s];for(var c in h){var v=this.accessor.i(c+"_"+s,h[c]);v&&t.push(v)}}return ct.all(t).then(function(t){var r;e.transferables=[];var n={attributes:t.reduce(function(t,n){return n.material?(a=n.material,n.transferables&&n.transferables.forEach(function(t){e.transferables.indexOf(t)<0&&e.transferables.push(t)})):("indices"===n.name?r=n:t[n.name]=n,e.transferables.indexOf(n.array.buffer)<0&&e.transferables.push(n.array.buffer)),t},{}),material:a};return r&&(n.indices=r),n.mode=dt(i.mode)?i.mode:4,dt(i.extras)&&(n.extras=i.extras),n})},n.P=function(t){var e=t.material;if(2===this.version)return dt(e)?this.adapter.getMaterial(e):null;var a=this.adapter.getBaseColorTexture(e);return a?this.h(a.source).then(function(t){var n=[t.buffer],r=a.source;t.index=r,wt(a.source,r),a.source.image=t;var i={baseColorTexture:a};return e.name&&(i.name=e.name),e.extensions&&(i.extensions=e.extensions),i.extensions&&(delete i.extensions.KHR_binary_glTF,delete i.extensions.binary_glTF,0===Object.keys(i.extensions).length&&delete i.extensions),e.extras&&(i.extras=e.extras),{material:i,transferables:n}}):null},n.h=function(t){var r=this;if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){var n=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;if(t.extensions&&(t.mimeType=n.mimeType,t.width=n.width,t.height=n.height),this.buffers[n.bufferView])return ct.resolve(this.buffers[n.bufferView]);var i=this.gltf.bufferViews[n.bufferView],e=(i.byteOffset||0)+this.glbBuffer.byteOffset,a=i.byteLength,u=this.buffers[n.bufferView]=new Uint8Array(this.glbBuffer.buffer,e,a);return ct.resolve(u)}var o=t.uri,f=this.rootPath+"/"+o;return this.requests[f]?this.requests[f].then(function(){return r.buffers[f]}):this.requests[f]=vt.getArrayBuffer(f,null).then(function(t){var n=t.data;return r.buffers[f]=n,new Uint8Array(n)})},t}();function Pt(t,i){var e=new Image;e.crossOrigin="",e.onload=function(){if(kt){kt.width=e.width,kt.height=e.height;var t=kt.getContext("2d");t.drawImage(e,0,0,e.width,e.height);var n=t.getImageData(0,0,e.width,e.height),r={width:e.width,height:e.height,data:new Uint8Array(n.data)};i(null,r)}else i(new Error("There is no canvas to draw image!"))},e.onerror=function(t){i(t)},e.src=t}var Xt=function(){function t(t){this.u=t}t.createEmptyB3DM=function(){return{featureTable:null,batchTable:null,gltf:{}}};var n=t.prototype;return n.load=function(r,t){var i=this;return t?this.X(r,t):vt.getArrayBuffer(r,{}).then(function(t){var n=t.data;return i.X(r,n)})},n.X=function(t,n){var r=this.D(n),i=t.substring(0,t.lastIndexOf("/")),e=new Ft(i,r.glb,{requestImage:this.u});return e.load().then(function(t){return{transferables:e.transferables,featureTable:r.featureTable,batchTable:r.batchTable,gltf:t}})},n.D=function(t){var n,r=new DataView(t),i=r.getUint32(4,!0);if(1!==i)throw new Error("Unsupported b3dm version : "+i);if(r.getUint32(8,!0)!==t.byteLength)throw new Error("Length in b3dm header is inconsistent with b3dm's byte length.");for(var e=20;e<t.byteLength;){if(1179937895===r.getUint32(e,!0)){n=e;break}e+=4}return{glb:{buffer:t,byteOffset:n}}},n.q=function(){return null},n.V=function(){return null},t}();function Dt(t){return t/Math.PI*180}var qt=[1,1,1,1,2,2,3,0];new Array(3),new Array(3);var Vt=[1/6378137,1/6378137,1/6356752.314245179],Bt=[1/40680631590769,1/40680631590769,1/40408299984661.445],zt=new Array(3),Gt=new Array(3),Zt=new Array(3);function Ht(t,n){var r=Bt,i=function(t,n,r,i,e){var a=n[0],u=n[1],o=n[2],f=r[0],s=r[1],h=r[2],c=a*a*f*f,v=u*u*s*s,l=o*o*h*h,d=c+v+l,M=Math.sqrt(1/d),w=N(Jt,n,M);if(d<e)return isFinite(M)?w:void 0;var m=i[0],p=i[1],y=i[2],b=Yt;b[0]=w[0]*m*2,b[1]=w[1]*p*2,b[2]=w[2]*y*2;var g,T,A,E,x,_,C,I=(1-M)*Kt(n)/(.5*Kt(b)),L=0;do{var O=-2*(c*((x=(T=1/(1+(I-=L)*m))*T)*T)*m+v*((_=(A=1/(1+I*p))*A)*A)*p+l*((C=(E=1/(1+I*y))*E)*E)*y);L=(g=c*x+v*_+l*C-1)/O}while(Math.abs(g)>Qt);return t[0]=a*T,t[1]=u*A,t[2]=o*E,t}(zt,n,Vt,r,.1),e=A(Gt,i,r);e=function(t,n){var r=n[0],i=n[1],e=n[2],a=r*r+i*i+e*e;0<a&&(a=Math.sqrt(a),t[0]=n[0]/a,t[1]=n[1]/a,t[2]=n[2]/a);return t}(e,e);var a,u=g(Zt,n,i),o=Math.atan2(e[1],e[0]),f=Math.asin(e[2]),s=(a=w(u,n),(Math.sign?Math.sign(a):0==(a=+a)||isNaN(a)?Number(a):0<a?1:-1)*Kt(u));return t[0]=Dt(o),t[1]=Dt(f),t[2]=s,t}var Jt=new Array(3),Yt=new Array(3),Qt=1e-12;function Kt(t){return u(t)}var Wt=Math.PI/180,$t=6378137*Math.PI/180,tn=85.0511287798,nn=6378137;function rn(t,n){var r,i=tn,e=n[0],a=Math.max(Math.min(i,n[1]),-i);return r=0===a?0:Math.log(Math.tan((90+a)*Wt/2))/Wt,t[0]=e*$t,t[1]=r*$t,t}var en=[0,0];function an(t,n,r){return function(t,n,r,i){if(!n)return;r||(r=0);i||(i=0);if(!r&&!i)return t[0]=n[0],t[1]=n[1];var e,a,u=un(n[1]);if(0!==i){var o=Math.abs(i),f=2*Math.sin(o/(2*nn));a=on(180*(u+=f*(0<i?1:-1))/Math.PI,-90,90)}else a=n[1];if(0!==r){var s=Math.abs(r),h=un(n[0]),c=2*Math.sqrt(Math.pow(Math.sin(s/(2*nn)),2)/Math.pow(Math.cos(u),2));e=on(180*(h+=c*(0<r?1:-1))/Math.PI,-180,180)}else e=n[0];t[0]=e,t[1]=a}(en,t,r,0),rn(en,en),en[0]-n[0]}function un(t){return t*Math.PI/180}function on(t,n,r){if(t===r||t===n)return t;var i=r-n;return((t-n)%i+i)%i+n}function fn(t,n){if(t.scenes&&t.scenes.length)for(var r=0,i=t.scenes.length;r<i;r++)for(var e=t.scenes[r].nodes,a=0,u=e.length;a<u;a++){var o=[],f=e[a];f.matrix&&o.push(f.matrix),sn(f,o,t,n)}}function sn(t,n,r,i){if(n=n.slice(0),t.matrix&&n.push(t.matrix),t.children&&t.children.length)for(var e=0,a=t.children.length;e<a;e++)sn(t.children[e],n,r,i);if(t.meshes&&t.meshes.length)for(var u=0,o=t.meshes.length;u<o;u++){var f=t.meshes[u];if(f)for(var s=n.slice(0),h=f.primitives,c=0,v=h.length;c<v;c++){var l=h[c];l&&(l.matrices=s,i(l,r))}}}var hn,cn,vn,ln,dn,Mn,wn,mn,pn="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null,yn=Tn((hn=.5*Math.PI,cn=Math.cos(hn),vn=Math.sin(hn),(ln=[])[0]=1,ln[1]=0,ln[2]=0,ln[3]=0,ln[4]=cn,ln[5]=vn,ln[6]=0,ln[7]=-vn,ln[8]=cn,ln),[0,0,0]),bn=Tn((dn=.5*-Math.PI,Mn=Math.cos(dn),wn=Math.sin(dn),(mn=[])[0]=Mn,mn[1]=0,mn[2]=-wn,mn[3]=0,mn[4]=1,mn[5]=0,mn[6]=wn,mn[7]=0,mn[8]=Mn,mn),[0,0,0]),gn=function(){function t(t,n,r,i){this.id=t,this.options=n,this.b3dmLoader=new Xt(this.requestImage.bind(this)),this.B=r,this.G={},i()}var n=t.prototype;return n.requestImage=function(t,n){this.B("requestImage",{url:t},null,n)},n.loadTile=function(r,i){var e=this,n=r.url,t=r.arraybuffer;if(t){delete this.G[n];var a=new DataView(t).getUint8(0);if(123===a||32===a){var u=function(t,n,r){{if(pn){var i=new Uint8Array(t,n,r);return pn.decode(i)}var e=new Uint8Array(t,n,r);return function(t){for(var n=t.length,r="",i=0;i<n;){var e=t[i++];if(128&e){var a=qt[e>>3&7];if(!(64&e)||!a||n<i+a)return null;for(e&=63>>a;0<a;a-=1){var u=t[i++];if(128!=(192&u))return null;e=e<<6|63&u}}r+=String.fromCharCode(e)}return r}(e)}}(t,0,t.byteLength),o=JSON.parse(u);i(null,o)}else{this.b3dmLoader.load(n,t).then(function(t){var n=t.transferables;e.convertCoordinates(t.gltf,r.upAxis,r.transform),delete t.transferables,i(null,t,n)}).catch(function(t){i(t)})}}else{var f=this.options.services[r.rootIdx],s=f.urlParams;s&&(s=(0<n.indexOf("?")?"&":"?")+s);var h=vt.getArrayBuffer(n+(s||""),f.ajaxOptions),c=h.xhr;h=h.then(function(t){delete e.G[n],r.arraybuffer=t.data,e.loadTile(r,i)}).catch(function(t){delete e.G[n],i(t)}),this.G[n]=c}},n.abortTileLoading=function(t,n){var r=this.G[t.url];r&&r.abort(),delete this.G[t.url],n(null)},n.convertCoordinates=function(r,i,e){var a=this;for(var t in r.meshes)for(var n=r.meshes[t].primitives,u=0;u<n.length;u++){var o=n[u],f=o.attributes;for(var s in f){var h=f[s],c=h.byteStride;if(0<c)f[s].array=An(h.array,h.byteOffset,c,h.itemSize,h.count,h.componentType);else{var v=Ft.getTypedArrayCtor(h.componentType);f[s].array=new v(h.array.slice().buffer)}}var l=o.indices;if(0<l.byteStride)o.indices.array=An(l.array,l.byteOffset,l.byteStride,l.itemSize,l.count,l.componentType);else{var d=Ft.getTypedArrayCtor(o.indices.componentType);d!==o.indices.array.constructor&&(o.indices.array=new d(o.indices.array.slice().buffer))}}if(!r.extensions||!r.extensions.CESIUM_RTC){r.extensions=r.extensions||{};var M=1/0,w=-1/0,m=1/0,p=-1/0,y=1/0,b=-1/0;fn(r,function(t){var n=t.attributes&&t.attributes.POSITION;if(n)if(n.min&&n.max)M>n.min[0]&&(M=n.min[0]),w<n.max[0]&&(w=n.max[0]),m>n.min[1]&&(m=n.min[1]),p<n.max[1]&&(p=n.max[1]),y>n.min[2]&&(y=n.min[2]),b<n.max[2]&&(b=n.max[2]);else for(var r=t.attributes.POSITION.array,i=t.attributes.POSITION.itemSize,e=0,a=r.length;e<a;e+=i)r[e]<M&&(M=r[e]),r[e]>w&&(w=r[e]),r[e+1]<m&&(m=r[e+1]),r[e+1]>p&&(p=r[e+1]),2<i&&(r[e+2]<y&&(y=r[e+2]),r[e+2]>b&&(b=r[e+2]))});var g=[(M+w)/2,(m+p)/2,(y+b)/2];isNaN(g[2])&&(g[2]=0),e&&T(g,g,e),r.extensions.MAPTALKS_RTC={center:g}}fn(r,function(t){if(t.attributes&&t.attributes.POSITION){var n=r.extensions.CESIUM_RTC;a.projVertices(t.attributes.POSITION,n,r.extensions.MAPTALKS_RTC,i,e)}})},n.projVertices=function(t,n,r,i,e){i=i&&i.toUpperCase();var a=t.array,u=t.itemSize,o=n&&n.center,f=r&&r.center,s=null;"Y"===i?s=yn:"X"===i&&(s=bn);var h,c=[0,0,0,1],v=[0,0,0],l=[0,0],d=[0,0,0],M=o||f;M&&(Ht(v,M),rn(l,v),h=2<M.length?an(v,l,v[2]):0,d[0]=l[0],d[1]=l[1],d[2]=h,n&&(n.projCenter=d),r&&(r.projCenter=d)),s&&(s[5]=s[10]=0);for(var w=0,m=a.length;w<m;w+=u)c[0]=a[w],c[1]=a[w+1],c[2]=2<u?a[w+2]:0,s&&(c=T(c,c,s)),e&&(c=T(c,c,e)),o&&p(c,c,o),Ht(v,c),rn(l,v),h=c[2]?an(v,l,v[2]):0,a[w]=l[0]-d[0],a[w+1]=l[1]-d[1],2<u&&(a[w+2]=h-d[2]);return{projCenter:d}},n.onRemove=function(){},t}();function Tn(t,n){var r=[];return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=0,r[4]=t[3],r[5]=t[4],r[6]=t[5],r[7]=0,r[8]=t[6],r[9]=t[7],r[10]=t[8],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function An(t,n,r,i,e,a){for(var u=Ft.getTypedArrayCtor(a),o=i*u.BYTES_PER_ELEMENT,f=new Uint8Array(e*o),s=0;s<e;s++)for(var h=0;h<o;h++)f[s*o+h]=t[r*s+n+h];return new u(f.buffer)}var En=0,xn=function(){function t(t){this.workerId=t,this.workers={},this.Z={}}var n=t.prototype;return n.addLayer=function(t,n){var r=t.actorId,i=t.mapId,e=t.layerId,a=t.params;if(!this.H(i,e)){var u=this.J(i,e),o=a.options,f=this.send.bind(this,r);this.workers[u]=new gn(e,o,f,n)}},n.removeLayer=function(t,n){var r=t.mapId,i=t.layerId,e=this.H(r,i),a=this.J(r,i);delete this.workers[a],e&&e.onRemove(n)},n.loadTile=function(t,n){var r=t.mapId,i=t.layerId,e=t.params,a=this.H(r,i);a&&a.loadTile(e,n)},n.abortTileLoading=function(t,n){var r=t.mapId,i=t.layerId,e=t.params,a=this.H(r,i);a&&a.abortTileLoading(e,n)},n.receive=function(t){var n=t.callback,r=this.Z[n];delete this.Z[n],r&&t.error?r(new Error(t.error)):r&&r(null,t.data)},n.send=function(t,n,r,i,e){var a=e?t+"-"+En++:null;e&&(this.Z[a]=e),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:n,params:r,callback:String(a)},i||[])},n.J=function(t,n){return t+"-"+n},n.H=function(t,n){var r=this.J(t,n);return this.workers[r]},t}();t.initialize=function(){},t.onmessage=function(t,i){var n=t.data;this.dispatcher||(this.dispatcher=new xn(t.workerId)),"<response>"===t.type?this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t):this.dispatcher[n.command]({actorId:n.actorId,mapId:n.mapId,layerId:n.layerId,params:n.params},function(t,n,r){i(t,n,r)})},Object.defineProperty(t,"Y",{value:!0})}),t(0,function(t,E,I){function e(t,n){t.prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n}for(var x=[],n=0;n<6;n++)x[n]=[];var a=[];function _(t,n,r){F(t);for(var i=0;i<6;i++)if(!r||"0"!==r.charAt(i)){var e=x[i];if(a[0]=0<e[0]?n[1][0]:n[0][0],a[1]=0<e[1]?n[1][1]:n[0][1],a[2]=0<e[2]?n[1][2]:n[0][2],P(e,a)<0)return!1}return!0}var C=0,L=3,O=6,N=1,S=4,U=7,R=2,j=5,k=8;function F(t){var n=t,r=n[0],i=n[1],e=n[2],a=n[3],u=n[4],o=n[5],f=n[6],s=n[7],h=n[8],c=n[9],v=n[10],l=n[11],d=n[12],M=n[13],w=n[14],m=n[15];p(x[0],a-r,s-u,l-h,m-d),p(x[1],a+r,s+u,l+h,m+d),p(x[2],a+i,s+o,l+c,m+M),p(x[3],a-i,s-o,l-c,m-M),p(x[4],a-e,s-f,l-v,m-w),p(x[5],a+e,s+f,l+v,m+w)}var u=1/6;function p(t,n,r,i,e){return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=e*u,t}function P(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]}function o(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var i in r)t[i]=r[i]}return t}function y(t){return null!=t&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function X(t){return t*Math.PI/180}function D(t){return t/Math.PI*180}function f(t){var n=document.createElement("a");return n.href=t,t=n.href,n=null,t}function s(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):0<t?1:-1}var h=[1,1,1,1,2,2,3,0];var r=Object.freeze({__proto__:null,extend:o,isFunction:y,toRadian:X,toDegree:D,getAbsoluteURL:f,sign:s,stringFromUTF8Array:function(t){for(var n=t.length,r="",i=0;i<n;){var e=t[i++];if(128&e){var a=h[e>>3&7];if(!(64&e)||!a||n<i+a)return null;for(e&=63>>a;0<a;a-=1){var u=t[i++];if(128!=(192&u))return null;e=e<<6|63&u}}r+=String.fromCharCode(e)}return r}}),i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var c,v=(function(t){!function(a){var u,o,f="fulfilled",s="undefined",h=function(){var n=[],r=0;function i(){for(;n.length-r;){try{n[r]()}catch(t){a.console&&a.console.error(t)}n[r++]=o,1024==r&&(n.splice(0,1024),r=0)}}var e=function(){if(typeof MutationObserver===s)return typeof process!==s&&"function"==typeof process.nextTick?function(){process.nextTick(i)}:typeof setImmediate!==s?function(){setImmediate(i)}:function(){setTimeout(i,0)};var t=document.createElement("div");return new MutationObserver(i).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}();return function(t){n.push(t),n.length-r==1&&e()}}();function c(t){if(!(this instanceof c))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof t){var n=this;try{t(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+t+" is not a function")}function v(t,n){if("function"==typeof t.y)try{var r=t.y.call(o,n);t.p.resolve(r)}catch(n){t.p.reject(n)}else t.p.resolve(n)}function l(t,n){if("function"==typeof t.n)try{var r=t.n.call(o,n);t.p.resolve(r)}catch(n){t.p.reject(n)}else t.p.reject(n)}c.prototype={resolve:function(r){if(this.state===u){if(r===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var i=this;if(r&&("function"==typeof r||"object"==typeof r))try{var n=!0,t=r.then;if("function"==typeof t)return void t.call(r,function(t){n&&(n=!1,i.resolve(t))},function(t){n&&(n=!1,i.reject(t))})}catch(t){return void(n&&this.reject(t))}this.state=f,this.v=r,i.c&&h(function(){for(var t=0,n=i.c.length;t<n;t++)v(i.c[t],r)})}},reject:function(r){if(this.state===u){var t=this;this.state="rejected",this.v=r;var i=this.c;h(i?function(){for(var t=0,n=i.length;t<n;t++)l(i[t],r)}:function(){t.handled||!c.suppressUncaughtRejectionError&&a.console&&c.warn("You upset Zousan. Please catch rejections: ",r,r?r.stack:null)})}},then:function(t,n){var r=new c,i={y:t,n:n,p:r};if(this.state===u)this.c?this.c.push(i):this.c=[i];else{var e=this.state,a=this.v;this.handled=!0,h(function(){e===f?v(i,a):l(i,a)})}return r},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,i){i=i||"Timeout";var e=this;return new c(function(n,r){setTimeout(function(){r(Error(i))},t),e.then(function(t){n(t)},function(t){r(t)})})}},c.resolve=function(t){var n=new c;return n.resolve(t),n},c.reject=function(t){var n=new c;return n.c=[],n.reject(t),n},c.all=function(r){var i=[],e=0,a=new c;function t(t,n){t&&"function"==typeof t.then||(t=c.resolve(t)),t.then(function(t){i[n]=t,++e==r.length&&a.resolve(i)},function(t){a.reject(t)})}for(var n=0;n<r.length;n++)t(r[n],n);return r.length||a.resolve(i),a},c.warn=console.warn,t.exports&&(t.exports=c),a.define&&a.define.amd&&a.define([],function(){return c}),(a.Zousan=c).soon=h}(i)}(c={exports:{}},c.exports),c.exports),m=1e-6,l="undefined"!=typeof Float32Array?Float32Array:Array,d=Math.random;function M(){var t=new l(3);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function w(t){var n=t[0],r=t[1],i=t[2];return Math.sqrt(n*n+r*r+i*i)}function b(t,n,r){var i=new l(3);return i[0]=t,i[1]=n,i[2]=r,i}function q(t,n,r,i){return t[0]=n,t[1]=r,t[2]=i,t}function g(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function T(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t}function A(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t}function V(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t}function B(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t}function z(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2];return Math.sqrt(r*r+i*i+e*e)}function G(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2];return r*r+i*i+e*e}function Z(t){var n=t[0],r=t[1],i=t[2];return n*n+r*r+i*i}function H(t,n){var r=n[0],i=n[1],e=n[2],a=r*r+i*i+e*e;return 0<a&&(a=1/Math.sqrt(a),t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a),t}function J(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Y(t,n,r){var i=n[0],e=n[1],a=n[2],u=r[0],o=r[1],f=r[2];return t[0]=e*f-a*o,t[1]=a*u-i*f,t[2]=i*o-e*u,t}var Q,K=T,W=A,$=V,tt=z,nt=G,rt=w,it=Z,et=(Q=M(),function(t,n,r,i,e,a){var u=void 0,o=void 0;for(n||(n=3),r||(r=0),o=i?Math.min(i*n+r,t.length):t.length,u=r;u<o;u+=n)Q[0]=t[u],Q[1]=t[u+1],Q[2]=t[u+2],e(Q,Q,a),t[u]=Q[0],t[u+1]=Q[1],t[u+2]=Q[2];return t}),at=Object.freeze({__proto__:null,create:M,clone:function(t){var n=new l(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},length:w,fromValues:b,copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},set:q,add:g,subtract:T,multiply:A,divide:V,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t},min:function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t},max:function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t},scale:B,scaleAndAdd:function(t,n,r,i){return t[0]=n[0]+r[0]*i,t[1]=n[1]+r[1]*i,t[2]=n[2]+r[2]*i,t},distance:z,squaredDistance:G,squaredLength:Z,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t},normalize:H,dot:J,cross:Y,lerp:function(t,n,r,i){var e=n[0],a=n[1],u=n[2];return t[0]=e+i*(r[0]-e),t[1]=a+i*(r[1]-a),t[2]=u+i*(r[2]-u),t},hermite:function(t,n,r,i,e,a){var u=a*a,o=u*(2*a-3)+1,f=u*(a-2)+a,s=u*(a-1),h=u*(3-2*a);return t[0]=n[0]*o+r[0]*f+i[0]*s+e[0]*h,t[1]=n[1]*o+r[1]*f+i[1]*s+e[1]*h,t[2]=n[2]*o+r[2]*f+i[2]*s+e[2]*h,t},bezier:function(t,n,r,i,e,a){var u=1-a,o=u*u,f=a*a,s=o*u,h=3*a*o,c=3*f*u,v=f*a;return t[0]=n[0]*s+r[0]*h+i[0]*c+e[0]*v,t[1]=n[1]*s+r[1]*h+i[1]*c+e[1]*v,t[2]=n[2]*s+r[2]*h+i[2]*c+e[2]*v,t},random:function(t,n){n=n||1;var r=2*d()*Math.PI,i=2*d()-1,e=Math.sqrt(1-i*i)*n;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t[2]=i*n,t},transformMat4:function(t,n,r){var i=n[0],e=n[1],a=n[2],u=r[3]*i+r[7]*e+r[11]*a+r[15];return u=u||1,t[0]=(r[0]*i+r[4]*e+r[8]*a+r[12])/u,t[1]=(r[1]*i+r[5]*e+r[9]*a+r[13])/u,t[2]=(r[2]*i+r[6]*e+r[10]*a+r[14])/u,t},transformMat3:function(t,n,r){var i=n[0],e=n[1],a=n[2];return t[0]=i*r[0]+e*r[3]+a*r[6],t[1]=i*r[1]+e*r[4]+a*r[7],t[2]=i*r[2]+e*r[5]+a*r[8],t},transformQuat:function(t,n,r){var i=r[0],e=r[1],a=r[2],u=r[3],o=n[0],f=n[1],s=n[2],h=e*s-a*f,c=a*o-i*s,v=i*f-e*o,l=e*v-a*c,d=a*h-i*v,M=i*c-e*h,w=2*u;return h*=w,c*=w,v*=w,l*=2,d*=2,M*=2,t[0]=o+h+l,t[1]=f+c+d,t[2]=s+v+M,t},rotateX:function(t,n,r,i){var e=[],a=[];return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],a[0]=e[0],a[1]=e[1]*Math.cos(i)-e[2]*Math.sin(i),a[2]=e[1]*Math.sin(i)+e[2]*Math.cos(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateY:function(t,n,r,i){var e=[],a=[];return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],a[0]=e[2]*Math.sin(i)+e[0]*Math.cos(i),a[1]=e[1],a[2]=e[2]*Math.cos(i)-e[0]*Math.sin(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateZ:function(t,n,r,i){var e=[],a=[];return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],a[0]=e[0]*Math.cos(i)-e[1]*Math.sin(i),a[1]=e[0]*Math.sin(i)+e[1]*Math.cos(i),a[2]=e[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},angle:function(t,n){var r=b(t[0],t[1],t[2]),i=b(n[0],n[1],n[2]);H(r,r),H(i,i);var e=J(r,i);return 1<e?0:e<-1?Math.PI:Math.acos(e)},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},equals:function(t,n){var r=t[0],i=t[1],e=t[2],a=n[0],u=n[1],o=n[2];return Math.abs(r-a)<=m*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=m*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(e-o)<=m*Math.max(1,Math.abs(e),Math.abs(o))},sub:K,mul:W,div:$,dist:tt,sqrDist:nt,len:rt,sqrLen:it,forEach:et});function ut(){var t=new l(4);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ot(t,n,r,i,e){return t[0]=n,t[1]=r,t[2]=i,t[3]=e,t}function ft(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t}function st(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t[3]=n[3]*r[3],t}function ht(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t[3]=n[3]/r[3],t}function ct(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2],a=n[3]-t[3];return Math.sqrt(r*r+i*i+e*e+a*a)}function vt(t,n){var r=n[0]-t[0],i=n[1]-t[1],e=n[2]-t[2],a=n[3]-t[3];return r*r+i*i+e*e+a*a}function lt(t){var n=t[0],r=t[1],i=t[2],e=t[3];return Math.sqrt(n*n+r*r+i*i+e*e)}function dt(t){var n=t[0],r=t[1],i=t[2],e=t[3];return n*n+r*r+i*i+e*e}function Mt(t,n){var r=n[0],i=n[1],e=n[2],a=n[3],u=r*r+i*i+e*e+a*a;return 0<u&&(u=1/Math.sqrt(u),t[0]=r*u,t[1]=i*u,t[2]=e*u,t[3]=a*u),t}var wt,mt=ft,pt=st,yt=ht,bt=ct,gt=vt,Tt=lt,At=dt,Et=(wt=ut(),function(t,n,r,i,e,a){var u=void 0,o=void 0;for(n||(n=4),r||(r=0),o=i?Math.min(i*n+r,t.length):t.length,u=r;u<o;u+=n)wt[0]=t[u],wt[1]=t[u+1],wt[2]=t[u+2],wt[3]=t[u+3],e(wt,wt,a),t[u]=wt[0],t[u+1]=wt[1],t[u+2]=wt[2],t[u+3]=wt[3];return t}),xt=Object.freeze({__proto__:null,create:ut,clone:function(t){var n=new l(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},fromValues:function(t,n,r,i){var e=new l(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},set:ot,add:function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t},subtract:ft,multiply:st,divide:ht,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t},min:function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t[3]=Math.min(n[3],r[3]),t},max:function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t[3]=Math.max(n[3],r[3]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t},scale:function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t},scaleAndAdd:function(t,n,r,i){return t[0]=n[0]+r[0]*i,t[1]=n[1]+r[1]*i,t[2]=n[2]+r[2]*i,t[3]=n[3]+r[3]*i,t},distance:ct,squaredDistance:vt,length:lt,squaredLength:dt,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t},normalize:Mt,dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},lerp:function(t,n,r,i){var e=n[0],a=n[1],u=n[2],o=n[3];return t[0]=e+i*(r[0]-e),t[1]=a+i*(r[1]-a),t[2]=u+i*(r[2]-u),t[3]=o+i*(r[3]-o),t},random:function(t,n){var r,i,e,a,u,o;for(n=n||1;1<=(u=(r=2*d()-1)*r+(i=2*d()-1)*i););for(;1<=(o=(e=2*d()-1)*e+(a=2*d()-1)*a););var f=Math.sqrt((1-u)/o);return t[0]=n*r,t[1]=n*i,t[2]=n*e*f,t[3]=n*a*f,t},transformMat4:function(t,n,r){var i=n[0],e=n[1],a=n[2],u=n[3];return t[0]=r[0]*i+r[4]*e+r[8]*a+r[12]*u,t[1]=r[1]*i+r[5]*e+r[9]*a+r[13]*u,t[2]=r[2]*i+r[6]*e+r[10]*a+r[14]*u,t[3]=r[3]*i+r[7]*e+r[11]*a+r[15]*u,t},transformQuat:function(t,n,r){var i=n[0],e=n[1],a=n[2],u=r[0],o=r[1],f=r[2],s=r[3],h=s*i+o*a-f*e,c=s*e+f*i-u*a,v=s*a+u*e-o*i,l=-u*i-o*e-f*a;return t[0]=h*s+l*-u+c*-f-v*-o,t[1]=c*s+l*-o+v*-u-h*-f,t[2]=v*s+l*-f+h*-o-c*-u,t[3]=n[3],t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},equals:function(t,n){var r=t[0],i=t[1],e=t[2],a=t[3],u=n[0],o=n[1],f=n[2],s=n[3];return Math.abs(r-u)<=m*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-o)<=m*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(e-f)<=m*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(a-s)<=m*Math.max(1,Math.abs(a),Math.abs(s))},sub:mt,mul:pt,div:yt,dist:bt,sqrDist:gt,len:Tt,sqrLen:At,forEach:Et});function _t(){var t=new l(4);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ct(t,n,r,i){var e=n[0],a=n[1],u=n[2],o=n[3],f=r[0],s=r[1],h=r[2],c=r[3],v=void 0,l=void 0,d=void 0,M=void 0,w=void 0;return(l=e*f+a*s+u*h+o*c)<0&&(l=-l,f=-f,s=-s,h=-h,c=-c),w=m<1-l?(v=Math.acos(l),d=Math.sin(v),M=Math.sin((1-i)*v)/d,Math.sin(i*v)/d):(M=1-i,i),t[0]=M*e+w*f,t[1]=M*a+w*s,t[2]=M*u+w*h,t[3]=M*o+w*c,t}var It,Lt,Ot,Nt,St,Ut,Rt,jt=Mt;It=M(),Lt=b(1,0,0),Ot=b(0,1,0),Nt=_t(),St=_t(),Ut=new l(9),l!=Float32Array&&(Ut[1]=0,Ut[2]=0,Ut[3]=0,Ut[5]=0,Ut[6]=0,Ut[7]=0),Ut[0]=1,Ut[4]=1,Ut[8]=1,Rt=Ut;kt=new l(2),l!=Float32Array&&(kt[0]=0,kt[1]=0),Ft=kt;var kt,Ft,Pt="undefined"!=typeof Promise?Promise:v,Xt={get:function(n,e){var a=Xt.t(),t=new Pt(function(r,i){if(a.open("GET",n,!0),e){for(var t in e.headers)a.setRequestHeader(t,e.headers[t]);a.withCredentials="include"===e.credentials,e.responseType&&(a.responseType=e.responseType)}a.onreadystatechange=Xt.r(a,function(t,n){t?i(t):r(n)}),a.send(null)});return t.xhr=a,t},r:function(t,n){return function(){if(4===t.readyState)if(200===t.status)"arraybuffer"===t.responseType?0===t.response.byteLength?n(new Error("http status 200 returned without content.")):n(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):n(null,t.responseText);else{if(0===t.status)return;n(new Error(t.statusText+","+t.status))}}},t:function(){var n;try{n=new XMLHttpRequest}catch(t){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}}return n},getArrayBuffer:function(t,n){return n||(n={}),n.responseType="arraybuffer",Xt.get(t,n)}};function Dt(t){return null==t}function qt(t){return!Dt(t)}function Vt(t){return"number"==typeof t&&isFinite(t)}function Bt(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var i in r)t[i]=r[i]}return t}function zt(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}Xt.getJSON=function(t,n){var r=Xt.get(t,n),i=r.then(function(t){return t?JSON.parse(t):null});return i.xhr=r.xhr,i};var Gt=function(){function t(t,n){this.rootPath=t,this.gltf=n}var n=t.prototype;return n.iterate=function(t,n){var r=this.gltf[n];if(r){var i=0;for(var e in r)t(e,r[e],i++)}},n.createNode=function(t,n){var r={};return qt(t.name)&&(r.name=t.name),qt(t.children)&&(r.children=t.children),qt(t.jointName)&&(r.jointName=t.jointName),qt(t.matrix)&&(r.matrix=t.matrix),qt(t.rotation)&&(r.rotation=t.rotation),qt(t.scale)&&(r.scale=t.scale),qt(t.translation)&&(r.translation=t.translation),qt(t.extras)&&(r.extras=t.extras),qt(t.meshes)&&(r.meshes=t.meshes.map(function(t){return n[t]})),r},n.getBaseColorTexture=function(t){var n,r,i=this.gltf.materials[t];if(void 0===(r=i.instanceTechnique&&i.instanceTechnique.values?(n=i.instanceTechnique).values.diffuse:(n=i).values.tex||n.values.diffuseTex||n.values.diffuse)||void 0===this.gltf.textures)return null;var e=this.gltf.textures[r];if(!e)return null;var a=this.gltf.samplers[e.sampler];return{format:e.format||6408,internalFormat:e.internalFormat||6408,type:e.type||5121,sampler:a,source:this.gltf.images[e.source]}},n.getMaterial=function(){return null},n.getAnimations=function(){return null},t}(),Zt=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],Ht=function(){function t(t,n,r,i){this.rootPath=t,this.gltf=n,this.glbBuffer=r,this.buffers={},this.requests={},this.ignoreGLBOffset=i}var n=t.prototype;return n.i=function(r,i){var e=this,t=this.gltf,n=t.accessors[i],a=t.bufferViews[n.bufferView],u=t.buffers[a.buffer];if("binary_glTF"!==a.buffer&&"KHR_binary_glTF"!==a.buffer&&u.uri){var o=u.uri,f=0===u.uri.indexOf("data:application/")?u.uri:this.rootPath+"/"+o;return this.requests[f]?this.requests[f].then(function(){return e.e(r,i,e.buffers[f])}):this.requests[f]=Xt.getArrayBuffer(f,null).then(function(t){var n=t.data;return e.buffers[f]=n,e.e(r,i,n)})}var s=this.e(r,i,this.glbBuffer.buffer,this.ignoreGLBOffset?0:this.glbBuffer.byteOffset);return Pt.resolve(s)},n.e=function(t,n,r,i){void 0===i&&(i=0);var e=this.gltf,a=e.accessors[n],u=e.bufferViews[a.bufferView],o=(u.byteOffset||0)+i,f=this.a(a.type),s=zt(a.componentType),h=s.BYTES_PER_ELEMENT,c=u.byteStride||0;c===h*f&&(c=0);var v={array:void 0,name:t,accessorName:n,bufferView:a.bufferView,byteOffset:c&&a.byteOffset||0,byteStride:c,byteLength:a.count*f*s.BYTES_PER_ELEMENT,componentType:a.componentType,count:a.count,type:a.type,itemSize:f};if(a.min&&(v.min=a.min),a.max&&(v.max=a.max),0===c){var l=o+(a.byteOffset||0);l%s.BYTES_PER_ELEMENT!=0&&(console.warn(t+"'s bytes is not aligned"),r=r.slice(o,o+a.count*f*s.BYTES_PER_ELEMENT),l=0),delete v.bufferView,v.array=new s(r,l,f*a.count)}else v.array=new Uint8Array(r,o,u.byteLength);return v},n.a=function(t){var n=Zt.indexOf(t);return Zt[n+1]},t}(),Jt=function(){function t(t,n,r,i){this.rootPath=t,this.gltf=n,this.glbBuffer=r,this.buffers={},this.requests={},this.u=i,this.accessor=new Ht(t,n,r)}var n=t.prototype;return n.iterate=function(t,n){var r=this.gltf[n];if(r)for(var i=0;i<r.length;i++)t(i,r[i],i)},n.createNode=function(t,n,r){var i={};return Bt(i,t),qt(t.mesh)&&(i.meshes=[n[t.mesh]]),qt(t.skin)&&(i.skin=r[t.skin],i.skinIndex=t.skin),!qt(t.weights)&&i.meshes?i.weights=i.meshes[0].weights:i.weights=t.weights,i},n.getMaterial=function(t){var e=this.gltf.materials[t],n=e.pbrMetallicRoughness,r=e.normalTexture,i=e.occlusionTexture,a=e.emissiveTexture,u=e.extensions,o=[];if(n&&(n.name="pbrMetallicRoughness",o.push(this.o(n,["baseColorTexture","metallicRoughnessTexture"]))),r&&o.push(this.f(r,"normalTexture")),i&&o.push(this.f(i,"occlusionTexture")),a&&o.push(this.f(a,"emissiveTexture")),u){var f=u.KHR_materials_pbrSpecularGlossiness;f&&(f.name="pbrSpecularGlossiness",o.push(this.o(f,["diffuseTexture","specularGlossinessTexture"])))}return Pt.all(o).then(function(t){var n={};Bt(n,e);for(var r=0;r<t.length;r++)n[t[r].name]=t[r];if(n.extensions){var i=n.extensions.KHR_materials_unlit;i&&(n.unlit=i),delete n.extensions}return{material:n}})},n.o=function(i,t){for(var n=[],r=0;r<t.length;r++){var e=i[t[r]];e&&n.push(this.f(e,t[r]))}return Pt.all(n).then(function(t){var n={};Bt(n,i);for(var r=0;r<t.length;r++)delete t[r].index,n[t[r].name]=t[r];return n})},n.f=function(r,t){var n=r.index,i=r.extensions;return qt(n)?(i&&i.KHR_texture_transform&&(r.KHR_texture_transform={},Bt(r.KHR_texture_transform,i.KHR_texture_transform),delete r.extensions),r.name=t,this.s(n).then(function(t){var n={texture:t};return Bt(n,r),delete n.index,n})):null},n.s=function(t){var i=this,e=this.gltf.textures[t];if(!e)return null;var a=this.gltf.images[e.source];return this.h(a).then(function(t){var n={image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:a.mimeType,name:a.name,extensions:a.extensions,extras:a.extras}};Bt(n,e),delete n.sampler;var r=qt(e.sampler)?i.gltf.samplers[e.sampler]:void 0;return r&&(n.sampler=r),n})},n.h=function(t){if(!qt(t.bufferView)){var n=t.uri,r=0===n.indexOf("data:image/")?n:this.rootPath+"/"+n;return this.l(r)}var i=this.gltf.bufferViews[t.bufferView];if(this.buffers[t.bufferView])return Pt.resolve(this.buffers[t.bufferView]);var e=this.gltf.buffers[i.buffer];return e.uri?this.d(e.uri,i,t):this.glbBuffer?this.M(i,t):null},n.l=function(t){var n=this;return this.requests[t]?this.requests[t].then(function(){return n.buffers[t]}):this.requests[t]=this.w(t,t)},n.d=function(t,a,u){var o=this,f=u.bufferView;return this.requests[t]?this.requests[t].then(function(){return o.buffers[f]}):Xt.getArrayBuffer(t,null).then(function(t){var n=t.data,r=o.m(a,n),i=new Blob([r],{type:u.mimeType}),e=URL.createObjectURL(i);return o.w(f,e)})},n.M=function(t,n){var r=this.m(t,this.glbBuffer.buffer),i=new Blob([r],{type:n.mimeType}),e=URL.createObjectURL(i);return this.w(n.bufferView,e)},n.w=function(e,t){var a=this;return new Pt(function(r,i){a.u(t,function(t,n){t?i(t):(a.buffers[e]=n,r(a.buffers[e]))})})},n.m=function(t,n,r){r=r||0;var i=t.byteOffset+r,e=t.byteLength;return n.slice(i,i+e)},n.b=function(t,n){for(var r=new Array(t.byteLength),i=0;i<t.byteLength;i++)r[i]=String.fromCharCode(t[i]);return r.join(""),"data:"+(n=n||"image/png")+";base64,"+window.btoa(unescape(encodeURIComponent(r)))},n.getAnimations=function(r){var n=this,i=[];return r.forEach(function(t){i.push(n.getSamplers(t.samplers))}),Pt.all(i).then(function(t){for(var n=0;n<t.length;n++)r[n].samplers=t[n];return r})},n.getSamplers=function(r){for(var t=[],n=0;n<r.length;n++)(qt(r[n].input)||qt(r[n].output))&&(t.push(this.accessor.i("input",r[n].input)),t.push(this.accessor.i("output",r[n].output)));return Pt.all(t).then(function(t){for(var n=0;n<t.length/2;n++)r[n].input=t[2*n],r[n].output=t[2*n+1],r[n].interpolation||(r[n].interpolation="LINEAR");return r})},t}(),Yt="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null,Qt=1313821514,Kt=5130562,Wt=function(){function e(){}return e.read=function(t,n){void 0===n&&(n=0);var r=new DataView(t,n),i=r.getUint32(4,!0);if(1===i)return e.readV1(r,n);if(2===i)return e.readV2(t,n);throw new Error("Unsupported glb version : "+i)},e.readV1=function(t,n){var r=t.getUint32(8,!0),i=t.getUint32(12,!0);if(r!==t.buffer.byteLength-n)throw new Error("Length in GLB header is inconsistent with glb's byte length.");var e=$t(t.buffer,20+n,i);return{json:JSON.parse(e),glbBuffer:{byteOffset:20+n+i,buffer:t.buffer}}},e.readV2=function(t,n){for(var r,i,e=new DataView(t,n+12),a=0;a<e.byteLength;){var u=e.getUint32(a,!0);a+=4;var o=e.getUint32(a,!0);if(a+=4,o===Qt)r=$t(t,n+12+a,u);else if(o===Kt){var f=n+12+a;i=t.slice(f,f+u)}a+=u}return{json:JSON.parse(r),glbBuffer:{byteOffset:n,buffer:i}}},e}();function $t(t,n,r){if(Yt){var i=new Uint8Array(t,n,r);return Yt.decode(i)}return function(t){for(var n=t.length,r="",i=0;i<n;){var e=t[i++];if(128&e){var a=tn[e>>3&7];if(!(64&e)||!a||n<i+a)return null;for(e&=63>>a;0<a;a-=1){var u=t[i++];if(128!=(192&u))return null;e=e<<6|63&u}}r+=String.fromCharCode(e)}return r}(new Uint8Array(t,n,r))}var tn=[1,1,1,1,2,2,3,0],nn=[0,0,0],rn=[0,0,0,1],en=[1,1,1],an=[0,0,0],un=[0,0,0,1],on=[1,1,1],fn={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},sn={g:function(t,n,r,i,e,a,u){for(var o=t.animations,f=0;f<o.length;f++)for(var s=o[f],h=s.channels,c=0;c<h.length;c++){var v=h[c];v.target.node===n&&("translation"===v.target.path?this.T(i,s.samplers[v.sampler],r,1):"rotation"===v.target.path?this.A(e,s.samplers[v.sampler],r,1):"scale"===v.target.path?this.T(a,s.samplers[v.sampler],r,1):"weights"===v.target.path&&u&&this.T(u,s.samplers[v.sampler],r,u.length))}},T:function(t,n,r,i){switch(n.interpolation){case"LINEAR":var e=this._(fn,n,r,1*i);e&&(t=function(t,n,r,i){for(var e=0;e<t.length;e++)t[e]=n[e]+i*(r[e]-n[e]);return t}(t,e.PREVIOUS,e.NEXT,e.INTERPOLATION));break;case"STEP":var a=this._(fn,n,r,1*i);a&&(t=function(t,n){for(var r=0;r<t.length;r++)t[r]=n[r];return t}.apply(void 0,[t].concat(a.PREVIOUS)));break;case"CUBICSPLINE":var u=this._(fn,n,r,3*i);u&&(t=this.C(t,u,n.input.array,3*i))}return t},A:function(t,n,r){switch(n.interpolation){case"LINEAR":var i=this._(fn,n,r,1);i&&Ct(t,i.PREVIOUS,i.NEXT,i.INTERPOLATION);break;case"STEP":var e=this._(fn,n,r,1);e&&(t=ot.apply(xt,[t].concat(e.PREVIOUS)));break;case"CUBICSPLINE":var a=this._(fn,n,r,3);if(a){for(var u=0;u<a.PREVIOUS.length;u++)a.PREVIOUS[u]=Math.acos(a.PREVIOUS[u]),a.NEXT[u]=Math.acos(a.NEXT[u]);t=this.C(t,a,n.input.array,3);for(var o=0;o<t.length;o++)t[o]=Math.cos(t[o])}}return t},_:function(t,n,r,i){var e,a,u,o=n.input.array,f=n.output.array,s=n.output.itemSize;(r<o[0]||r>o[o.length-1])&&(r=Math.max(o[0],Math.min(o[o.length-1],r))),r===o[o.length-1]&&(r=o[0]);for(var h=0;h<o.length-1;h++)if(r>=o[h]&&r<o[h+1]){var c=o[h];u=(r-c)/(o[a=(e=h)+1]-c);break}if(!a)return null;t.PREINDEX=e,t.NEXTINDEX=a,t.INTERPOLATION=u;var v=s*i;return t.PREVIOUS=f.subarray(t.PREINDEX*v,(t.PREINDEX+1)*v),t.NEXT=f.subarray(t.NEXTINDEX*v,(t.NEXTINDEX+1)*v),t},C:function(t,n,r,i){for(var e=n.INTERPOLATION,a=r[n.PREINDEX],u=r[n.NEXTINDEX],o=0;o<3;o++){var f=n.PREVIOUS[i+o],s=(u-a)*n.PREVIOUS[2*i+o],h=n.NEXT[3+o],c=(u-a)*n.NEXT[o],v=(2*Math.pow(e,3)-3*Math.pow(e,2)+1)*f+(Math.pow(e,3)-2*Math.pow(e,2)+e)*s+(2*-Math.pow(e,3)+3*Math.pow(e,2))*h+(Math.pow(e,3)-Math.pow(e,2))*c;t[o]=v}return t},getAnimationClip:function(t,n,r,i){var e,a,u,o,f,s,h,c,v,l,d,M,w,m,p,y,b,g,T,A,E,x,_,C=n.nodes[r]&&n.nodes[r].weights;q.apply(at,[nn].concat(an)),ot.apply(xt,[rn].concat(un)),q.apply(at,[en].concat(on)),this.g(n,r,i,nn,rn,en,C),e=t,u=nn,o=en,f=(a=rn)[0],s=a[1],h=a[2],c=a[3],M=f*(v=f+f),w=f*(l=s+s),m=f*(d=h+h),p=s*l,y=s*d,b=h*d,g=c*v,T=c*l,A=c*d,E=o[0],x=o[1],_=o[2],e[0]=(1-(p+b))*E,e[1]=(w+A)*E,e[2]=(m-T)*E,e[3]=0,e[4]=(w-A)*x,e[5]=(1-(M+b))*x,e[6]=(y+g)*x,e[7]=0,e[8]=(m+T)*_,e[9]=(y-g)*_,e[10]=(1-(M+p))*_,e[11]=0,e[12]=u[0],e[13]=u[1],e[14]=u[2],e[15]=1},getTimeSpan:function(t){if(!t.animations)return null;var a=-1/0,u=1/0;return t.animations.forEach(function(t){for(var n=t.channels,r=0;r<n.length;r++){var i=n[r],e=t.samplers[i.sampler].input.array;e[e.length-1]>a&&(a=e[e.length-1]),e[0]<u&&(u=e[0])}}),{max:a,min:u}}},hn="undefined"==typeof document?null:document.createElement("canvas"),cn=function(){function t(t,n,r){if(this.options=r||{},n.buffer instanceof ArrayBuffer){var i=Wt.read(n.buffer,n.byteOffset),e=i.json,a=i.glbBuffer;this.I(t,e,a)}else this.I(t,n)}var n=t.prototype;return n.load=function(){var t=this.L(),n=this.O();return Pt.all([t,n]).then(function(t){return t[0].animations=t[1],t[0]})},t.getAnimationClip=function(t,n,r,i){return sn.getAnimationClip(t,n,r,i)},t.getAnimationTimeSpan=function(t){return sn.getTimeSpan(t)},t.getTypedArrayCtor=function(t){return zt(t)},n.I=function(t,n,r){this.gltf=n,this.version=n.asset?+n.asset.version:1,this.rootPath=t,this.glbBuffer=r,this.buffers={},this.requests={},this.options.requestImage=this.options.requestImage||vn,2===this.version?(this.accessor=new Ht(t,n,r,!0),this.adapter=new Jt(t,n,r,this.options.requestImage)):(this.accessor=new Ht(t,n,r),this.adapter=new Gt(t,n))},n.N=function(t,r){var n,i=this;if(t.children&&0<t.children.length){if(!Vt(t.children[0])&&(Dt(n=t.children[0])||"string"!=typeof n&&(null===n.constructor||n.constructor!==String)))return t;var e=t.children.map(function(t){var n=r[t];return n.nodeIndex=t,i.N(n,r)});t.children=e}if(qt(t.skin)){var a=t.skin.joints;if(a&&a.length&&Vt(a[0])){var u=t.skin.joints.map(function(t){return r[t]});t.skin.joints=u}}return t},n.L=function(){var o=this;return this.S().then(function(e){var a,u=o.scenes=[];for(var t in e)e[t]=o.N(e[t],e),e[t].nodeIndex=Number(t)?Number(t):t;o.adapter.iterate(function(t,n,r){var i={};n.name&&(i.name=n.name),n.nodes&&(i.nodes=n.nodes.map(function(t){return e[t]})),o.gltf.scene===t&&(a=r),u.push(i)},"scenes");var n={scene:a,scenes:u,nodes:e,meshes:o.meshes,skins:o.skins};return o.gltf.extensions&&(n.extensions=o.gltf.extensions),n})},n.S=function(){var e=this;return this.U().then(function(){var i=e.nodes={};return e.adapter.iterate(function(t,n){var r=e.adapter.createNode(n,e.meshes,e.skins);i[t]=r},"nodes"),i})},n.R=function(){var i=this;this.skins={};var e=[];return this.adapter.iterate(function(n,t,r){e.push(i.j(t).then(function(t){t.index=r,i.skins[n]=t}))},"skins"),e},n.j=function(n){var t=n.inverseBindMatrices;return this.accessor.i("inverseBindMatrices",t).then(function(t){return n.inverseBindMatrices=t,n})},n.O=function(){var t=this.gltf.animations;return qt(t)?this.adapter.getAnimations(t):null},n.U=function(){var i=this;this.meshes={};var e=[];return this.adapter.iterate(function(n,t,r){e.push(i.k(t).then(function(t){t.index=r,i.meshes[n]=t}))},"meshes"),e=e.concat(this.R()),Pt.all(e)},n.k=function(r){var n=this,t=r.primitives.map(function(t){return n.F(t)});return Pt.all(t).then(function(t){var n={};return Bt(n,r),n.primitives=t,n})},n.F=function(i){var e=this,t=[],n=i.attributes,r=this.P(i);r&&t.push(r);var a=null;for(var u in n){var o=this.accessor.i(u,n[u]);o&&t.push(o)}if(qt(i.indices)){var f=this.accessor.i("indices",i.indices);f&&t.push(f)}if(qt(i.targets))for(var s=0;s<i.targets.length;s++){var h=i.targets[s];for(var c in h){var v=this.accessor.i(c+"_"+s,h[c]);v&&t.push(v)}}return Pt.all(t).then(function(t){var r;e.transferables=[];var n={attributes:t.reduce(function(t,n){return n.material?(a=n.material,n.transferables&&n.transferables.forEach(function(t){e.transferables.indexOf(t)<0&&e.transferables.push(t)})):("indices"===n.name?r=n:t[n.name]=n,e.transferables.indexOf(n.array.buffer)<0&&e.transferables.push(n.array.buffer)),t},{}),material:a};return r&&(n.indices=r),n.mode=qt(i.mode)?i.mode:4,qt(i.extras)&&(n.extras=i.extras),n})},n.P=function(t){var e=t.material;if(2===this.version)return qt(e)?this.adapter.getMaterial(e):null;var a=this.adapter.getBaseColorTexture(e);return a?this.h(a.source).then(function(t){var n=[t.buffer],r=a.source;t.index=r,Bt(a.source,r),a.source.image=t;var i={baseColorTexture:a};return e.name&&(i.name=e.name),e.extensions&&(i.extensions=e.extensions),i.extensions&&(delete i.extensions.KHR_binary_glTF,delete i.extensions.binary_glTF,0===Object.keys(i.extensions).length&&delete i.extensions),e.extras&&(i.extras=e.extras),{material:i,transferables:n}}):null},n.h=function(t){var r=this;if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){var n=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;if(t.extensions&&(t.mimeType=n.mimeType,t.width=n.width,t.height=n.height),this.buffers[n.bufferView])return Pt.resolve(this.buffers[n.bufferView]);var i=this.gltf.bufferViews[n.bufferView],e=(i.byteOffset||0)+this.glbBuffer.byteOffset,a=i.byteLength,u=this.buffers[n.bufferView]=new Uint8Array(this.glbBuffer.buffer,e,a);return Pt.resolve(u)}var o=t.uri,f=this.rootPath+"/"+o;return this.requests[f]?this.requests[f].then(function(){return r.buffers[f]}):this.requests[f]=Xt.getArrayBuffer(f,null).then(function(t){var n=t.data;return r.buffers[f]=n,new Uint8Array(n)})},t}();function vn(t,i){var e=new Image;e.crossOrigin="",e.onload=function(){if(hn){hn.width=e.width,hn.height=e.height;var t=hn.getContext("2d");t.drawImage(e,0,0,e.width,e.height);var n=t.getImageData(0,0,e.width,e.height),r={width:e.width,height:e.height,data:new Uint8Array(n.data)};i(null,r)}else i(new Error("There is no canvas to draw image!"))},e.onerror=function(t){i(t)},e.src=t}var ln="undefined"==typeof document?null:document.createElement("canvas"),dn=function(i){function t(t,n){var r;return(r=i.call(this,t)||this).mapId=n,r}e(t,i);var n=t.prototype;return n.initialize=function(t){t(null)},n.loadTile=function(t,n,r){var i=null;n&&n.arraybuffer&&(i=[n.arraybuffer]);var e={mapId:this.mapId,layerId:t,command:"loadTile",params:n};this.send(e,i,r)},n.abortTileLoading=function(t,n,r){var i={mapId:this.mapId,layerId:t,command:"abortTileLoading",params:{url:n}};this.broadcast(i,null,r)},n.addLayer=function(t,n,r){var i={actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:n}};this.broadcast(i,null,r)},n.removeLayer=function(t,n){var r={mapId:this.mapId,layerId:t,command:"removeLayer"};this.broadcast(r,null,n)},n.requestImage=function(t,e){var n=t.url,a=new Image;a.onload=function(){if(ln){var t=function(t){if(Mn(t.width)&&Mn(t.height))return t;var n=t.width,r=t.height;Mn(n)||(n=wn(n));Mn(r)||(r=wn(r));var i=document.createElement("canvas");i.width=n,i.height=r,i.getContext("2d").drawImage(t,0,0,n,r);var e=t.src,a=e.lastIndexOf("/")+1,u=e.substring(a);return console.warn("Texture("+u+")'s size is not power of two, resize from ("+t.width+", "+t.height+") to ("+n+", "+r+")"),i}(a);ln.width=t.width,ln.height=t.height;var n=ln.getContext("2d");n.drawImage(t,0,0,t.width,t.height);var r=n.getImageData(0,0,t.width,t.height),i={width:t.width,height:t.height,data:new Uint8Array(r.data)};e(null,i,[i.data.buffer])}else e(new Error("There is no canvas to draw image!"))},a.onerror=function(t){e(t)},a.src=n},t}(E.worker.Actor);function Mn(t){return 0==(t&t-1)&&0!==t}function wn(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function mn(t,n,r,i){if(n=n.slice(0),t.matrix&&n.push(t.matrix),t.children&&t.children.length)for(var e=0,a=t.children.length;e<a;e++)mn(t.children[e],n,r,i);if(t.meshes&&t.meshes.length)for(var u=0,o=t.meshes.length;u<o;u++){var f=t.meshes[u];if(f)for(var s=n.slice(0),h=f.primitives,c=0,v=h.length;c<v;c++){var l=h[c];l&&(l.matrices=s,i(l,r))}}}var pn={factor:0,units:0},yn=[0,0,0],bn=[1,1,1],gn=function(){function t(t,n){this.Q=n,this.K=n.getRenderer().canvas,this.W=new E.SpatialReference,this.$=t,this.tt=new I.reshader.Renderer(t),this.nt={},this.rt={},this.it={},this.et=new I.reshader.Scene,this.at=new I.reshader.Scene,this.ut=new I.reshader.ResourceLoader(t.texture(2)),this.ot=this.ft.bind(this),this.st()}var n=t.prototype;return n.getMap=function(){return this.Q.getMap()},n.paint=function(t,n,r,i){var e=this.getMap();if(t.length&&e){for(var a=e.projViewMatrix,u=this.Q.options.services,o=[],f=[],s=0,h=t.length;s<h;s++){var c=this.ht(t[s].data.node);if(c){var v=t[s].node,l=u[v.ct].polygonOffset||pn;y(l)&&(l=l());for(var d=u[v.ct].ambientLight||yn,M=0,w=c.length;M<w;M++)c[M].getBoundingBox&&!_(a,c[M].getBoundingBox())||(c[M].setUniform("level",t[s].selectionDepth),c[M].setUniform("polygonOffset",l),c[M].setUniform("ambientLight",d),c[M].vt=v.id,n[v.id]||o.push(c[M]),f.push(c[M]))}}this.lt.filter=r;var m=this.dt();m.debug=!1,this.et.setMeshes(o),m.stencilEnable=!1,m.cullFace="front",this.tt.render(this.lt,m,this.et,i&&i.fbo),m.stencilEnable=!0,m.debug=!1,m.cullFace="back",this.et.setMeshes(f),this.tt.render(this.lt,m,this.et,i&&i.fbo)}},n.paintRegion=function(t,n,r,i,e){var a=this.getMap();if(t.length||n.length){for(var u=a.projViewMatrix,o=[],f=0,s=(t=t.concat(n)).length;f<s;f++){var h=t[f].node,c=this.Mt(h);c&&(c.getBoundingBox&&!_(u,c.getBoundingBox())||o.push(c))}this.wt.filter=i,this.at.setMeshes(o);var v=this.mt(r);this.tt.render(this.wt,v,this.at,e&&e.fbo)}},n.deleteTile=function(t){var n=t.node.id;this.pt(n)},n.pt=function(t){var n=this.rt[t];n&&(n.geometry.dispose(),n.dispose(),delete this.rt[t]);var r=this.it[t]||this.nt[t];if(r){if(Array.isArray(r))for(var i=0,e=r.length;i<e;i++)r[i].geometry.dispose(),r[i].material.dispose(),r[i].dispose();else r.geometry.dispose(),r.material.dispose(),r.dispose();delete this.it[t],delete this.nt[t]}},n.remove=function(){for(var t in this.it)this.pt(t);for(var n in this.nt)this.pt(n);for(var r in this.rt)this.pt(r)},n.Mt=function(t){if(!t.boundingVolume||!t.boundingVolume.region)return null;if(this.rt[t.id])return this.rt[t.id];var n=this.getMap(),r=t.boundingVolume.region,i=new E.Coordinate(D(r[0]),D(r[1])),e=new E.Coordinate(D(r[2]),D(r[3]));i=n.coordToPoint(i,n.getGLZoom()),e=n.coordToPoint(e,n.getGLZoom());var a=i.add(e).yt(.5);i._sub(a),e._sub(a);var u=n.distanceToPoint(r[4],r[5],n.getGLZoom()),o=u.x,f=u.y,s=[i.x,i.y,f,e.x,i.y,f,e.x,e.y,f,i.x,e.y,f,i.x,i.y,o,e.x,i.y,o,e.x,e.y,o,i.x,e.y,o],h=new I.reshader.Geometry({aPosition:s},[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],0,{primitive:"lines"});h.generateBuffers(this.$);var c=new I.reshader.Mesh(h),v=I.mat4.identity([]);return c.setLocalTransform(I.mat4.translate(v,v,[a.x,a.y,0])),this.rt[t.id]=c},n.ht=function(t){return this.it[t.id]},n.has=function(t){return this.ht(t)||this.nt[t.id]},n.createModelMesh=function(t,h,n){var c,v=this;if(this.it[h.id]||this.nt[h.id]){var r=this.it[h.id];return console.warn("mesh with id("+h.id+") was already created."),this.nt[h.id]||n(null,{id:h.id,mesh:r}),r}if(h.maxExtent){var i=this.Q.getMap(),e=i.getGLZoom(),a=new E.Extent(h.maxExtent).convertTo(function(t){return i._pointToPrj(t,e)});c=[a.xmin,a.ymin,a.xmax,a.ymax]}var u=t.gltf,o=u.extensions.CESIUM_RTC||u.extensions.MAPTALKS_RTC,l=I.mat4.identity([]),d=[0,0],f=this.getMap(),s=new E.Coordinate(o.projCenter),M=f._prjToPoint(s,f.getGLZoom()),w=this.bt(),m=1/f.getResolution(f.getGLZoom());I.mat4.translate(l,l,[M.x,M.y,m*o.projCenter[2]]);var p=this.Q.options.services[h.ct].heightOffset;p&&I.mat4.translate(l,l,[0,0,m*p]),I.mat4.scale(l,l,I.vec3.scale([],w,m)),I.vec2.set(d,s.x,s.y);var y=[],b=0,g=!0;return function(t,n){if(t.scenes&&t.scenes.length)for(var r=0,i=t.scenes.length;r<i;r++)for(var e=t.scenes[r].nodes,a=0,u=e.length;a<u;a++){var o=[],f=e[a];f.matrix&&o.push(f.matrix),mn(f,o,t,n)}}(u,function(t){var n,r={aPosition:t.attributes.POSITION.array,aTexCoord:t.attributes.TEXCOORD_0?t.attributes.TEXCOORD_0.array:void 0,aNormal:t.attributes.NORMAL?t.attributes.NORMAL.array:void 0},i=new I.reshader.Geometry(r,t.indices.array?t.indices.array:t.indices,0,{primitive:void 0===t.mode?"triangles":(n=t.mode,Tn[n])});i.generateBuffers(v.$);var e=new I.reshader.Material({baseColor:[1,1,1,1]}),a=v.gt(t.material);a&&!a.isReady()?(g=!1,a.Tt=h.id,b++):a||(a=e);var u={},o=new I.reshader.Mesh(i,a);t.attributes.NORMAL&&(u.USE_NORMAL=1),Array.isArray(a.get("baseColor"))||(u.USE_BASECOLOR_TEXTURE=1),c&&(u.USE_MAX_EXTENT=1,o.setUniform("maxPrjExtent",c),o.setUniform("prjCenter",d)),o.setDefines(u);var f=I.mat4.identity([]);if(t.matrices&&t.matrices.length)for(var s=0;s<t.matrices.length;s++)I.vec3.multiply(f,f,t.matrices[s]);I.mat4.multiply(f,l,f),o.setLocalTransform(f),y.push(o)}),g?(this.it[h.id]=y,n(null,{id:h.id,mesh:y})):(this.nt[h.id]={meshes:y,count:b},y.At=n),y},n.st=function(){var t=this,n={x:0,y:0,width:function(){return t.K?t.K.width:1},height:function(){return t.K?t.K.height:1}};this.wt=new I.reshader.MeshShader({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\nvoid main() {\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n}\n",frag:"precision mediump float;\nuniform vec3 color;\nvoid main() {\n    gl_FragColor = vec4(color, 1.0);\n}\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:function(t,n){return I.mat4.multiply([],n.projViewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:n}}),this.lt=new I.reshader.MeshShader({vert:"attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 projViewModelMatrix;\nvarying vec2 vTexCoord;\n#ifdef USE_MAX_EXTENT\nvarying vec2 vXy;\n#endif\nvoid main() {\n    #ifdef USE_MAX_EXTENT\n    vXy = aPosition.xy;\n    #endif\n    vTexCoord = aTexCoord;\n    vec4 pos = projViewModelMatrix * vec4(aPosition, 1.0);\n    gl_Position = pos;\n}\n",frag:"precision mediump float;\n#ifdef USE_BASECOLOR_TEXTURE\nuniform sampler2D baseColor;\n#else\nuniform vec4 baseColor;\n#endif\nuniform vec3 ambientLight;\nuniform bool debug;\nuniform float linearColor;\nvarying vec2 vTexCoord;\n#ifdef USE_MAX_EXTENT\n    uniform vec4 maxExtent;\n    varying vec2 vXy;\n#endif\nvec3 sRGBToLinear(const in vec3 color) {\n    return vec3( color.r < 0.04045 ? color.r * (1.0 / 12.92) : pow((color.r + 0.055) * (1.0 / 1.055), 2.4), color.g < 0.04045 ? color.g * (1.0 / 12.92) : pow((color.g + 0.055) * (1.0 / 1.055), 2.4), color.b < 0.04045 ? color.b * (1.0 / 12.92) : pow((color.b + 0.055) * (1.0 / 1.055), 2.4));\n}\nvoid main() {\n    #ifdef USE_MAX_EXTENT\n        if (vXy.x < maxExtent.x || vXy.x > maxExtent.z || vXy.y < maxExtent.y || vXy.y > maxExtent.w) {\n            discard;\n            return;\n        }\n    #endif\n    if (debug) {\n        gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n    } else {\n        #ifdef USE_BASECOLOR_TEXTURE\n            gl_FragColor = vec4(texture2D(baseColor, vTexCoord).xyz + ambientLight, 1.0);\n        #else\n            gl_FragColor = baseColor;\n            gl_FragColor.rgb += ambientLight;\n        #endif\n    }\n    if (linearColor == 1.0) {\n        gl_FragColor = vec4(sRGBToLinear(gl_FragColor.rgb), gl_FragColor.a);\n    }\n}\n",uniforms:["ambientLight","baseColor","debug","linearColor",{name:"projViewModelMatrix",type:"function",fn:function(t,n){return I.mat4.multiply([],n.projViewMatrix,n.modelMatrix)}},{name:"maxExtent",type:"function",fn:function(t,n){var r=n.maxPrjExtent,i=n.prjCenter;return r?[r[0]-i[0],r[1]-i[1],r[2]-i[0],r[3]-i[1]]:null}}],extraCommandProps:{viewport:n,cull:{enable:!0,face:function(t,n){return n.cullFace}},stencil:{enable:function(t,n){return n.stencilEnable},func:{cmp:">=",ref:function(t,n){return n.level}},opFront:{fail:"keep",zfail:"keep",zpass:"replace"},opBack:{fail:"keep",zfail:"keep",zpass:"keep"}},polygonOffset:{enable:!0,offset:function(t,n){return n.polygonOffset}}}})},n.mt=function(t){return{projViewMatrix:this.getMap().projViewMatrix,color:t&&t.color||[0,1,0]}},n.dt=function(){var t=this.getMap(),n=this.Q;return{projViewMatrix:t.projViewMatrix,linearColor:n.options.sRGBToLinear?1:0}},n.gt=function(t){if(!t||!t.baseColorTexture&&!t.pbrMetallicRoughness)return null;var n,r,i,e,a,u=t.baseColorTexture||t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture;if(u){var o={type:u.type?(a=u.type,An[a]):"uint8",format:u.format?(e=u.format,En[e]):"rgba",flipY:!1};if(t.baseColorTexture)o.url=this.Et(u);else{var f=u.texture.image;o.data=f.array,o.width=f.width,o.height=f.height}var s=u.sampler||u.texture.sampler;s&&(s.magFilter&&(o.mag=(i=s.magFilter,xn[i])),s.minFilter&&(o.min=(r=s.minFilter,_n[r])),s.wrapS&&(o.wrapS=In(s.wrapS)),s.wrapT&&(o.wrapT=In(s.wrapT))),n=new I.reshader.Texture2D(o,this.ut)}var h={baseColor:t.baseColorFactor||t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorFactor||[1,1,1,1]};n&&(h.baseColor=n);var c=new I.reshader.Material(h);return c.once("complete",this.ot),c},n.Et=function(t){var n=t.source,r=window.URL||window.webkitURL,i=new Blob([n.image],{type:n.mimeType});return r.createObjectURL(i)},n.ft=function(t){var n=t.target.Tt,r=this.nt[n];if(r.count--,!r.count){var i=r.meshes;this.it[n]=i,delete this.nt[n];var e=i.At;delete i.At,e(null,{mesh:r.meshes,id:n})}},n.bt=function(){return bn},t}(),Tn=["points","lines","line strip","line loop","triangles","triangle strip","triangle fan"];var An={5121:"uint8",5123:"uint16",5125:"uint32",5126:"float",36193:"half float"};var En={6406:"alpha",6407:"rgb",6408:"rgba",6409:"luminance",6410:"luminance alpha"};var xn={9729:"linear",9728:"nearest"};var _n={9729:"linear",9728:"nearest",9984:"nearest mipmap nearest",9985:"linear mipmap nearest",9986:"nearest mipmap linear",9987:"linear mipmap linear"};var Cn={10497:"repeat",33071:"clamp",33648:"mirror"};function In(t){return Cn[t]}var Ln=function(r){function t(t){var n;return(n=r.call(this,t)||this).prepareWorker(),n.tilesLoading={},n.tileCache=new E.LRUCache(64,n.deleteTile.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n))),n.G={},n}e(t,r);var n=t.prototype;return n.needToRedraw=function(){return!!this.getMap().isInteracting()||r.prototype.needToRedraw.call(this)},n.drawOnInteracting=function(t,n,r){this.draw(n,r)},n.draw=function(t,n){var r=this.prepareCanvas();if(!r||r.intersects(this.canvasExtent2D)){var i=this.layer.getTiles(),e=i.root,a=i.tiles,u=a?Object.keys(a).length:0;if(a&&u){var o=3*u;o>=this.tileCache.max&&this.tileCache.setMaxSize(Math.min(o,this.layer.options.maxCacheSize));var f=this.xt(e,a),s=f.selectedTiles,h=f.leaves,c=f.requests,v=f.loading;this._t(s,h,n),this.Ct(),v?c.length&&this.loadTiles(c):this.completeRender()}else this.completeRender()}else this.completeRender()},n.xt=function(t,n){var r=[],i=this.It(),e=this.Lt(),a={},u=!1,o=!1;for(var f in n){var s=n[f],h=s.node;if(!a[h.id]){var c=!(a[h.id]=1),v=this.Ot(h.id);if(this.Nt(h.id)?(c=o=!0,this.tilesLoading[h.id].current=!0):v?(this.getTileOpacity(v)<1&&(c=o=!0),u=!0,s.selected=!0,s.data=v):this.painter.has(h)||(c=o=!0,r.push(h)),c)if(this.St(s))u=!0;else this.Ut(s).length&&(u=!0)}}var l=[],d={};if(u){var M=this.Rt(t);l=M.selectedTiles,d=M.leaves}if(1<r.length&&(r.sort(Nn),e)){var w=e-i;0<w&&(r=r.slice(0,w))}return{loading:o,requests:r,selectedTiles:l,leaves:d}},n.Rt=function(t){for(var n,r=[],i={},e=[t],a=[];0<e.length||0<a.length;){if(0<a.length){var u=a[a.length-1];if(u.jt===e.length){a.pop(),u===n&&(u.leave=!0,i[u.node.id]=1),r.push(u);continue}}var o=e.pop(),f=o.children;if(o.selected)if("add"===o.node.refine)i[o.node.id]=1,r.push(o);else{if(o.selectionDepth=a.length,n=o,0===f.length){o.leave=!0,i[o.node.id]=1,r.push(o);continue}a.push(o),o.jt=e.length}1<f.length&&f.sort(On);for(var s=0;s<f.length;s++)e.push(f[s])}return{selectedTiles:r,leaves:i}},n.St=function(t){if(!t.parent)return null;for(var n=t.parent;n&&0<=n.level;){var r=n.node.id;if(this.tileCache.has(r))return n.selected=!0,n.data=this.tileCache.get(r),n;n=n.parent}return null},n.Ut=function(t){var n=[];if(!t.node.children||!t.node.children.length)return n;for(var r=t.kt+1,i=[t.node];0<i.length;)for(var e=i.pop().children,a=0,u=e.length;a<u;a++)if(!this.layer.Ft(e[a])&&e[a].children&&e[a].children.length)i.push(e[a]);else{var o=e[a].id;if(this.tileCache.has(o)){var f=this.layer.Pt(e[a],t);f.selected=!0,f.data=this.tileCache.get(o),t.children.push(f),n.push(f)}else e[a].kt<=r&&i.push(e[a])}return n},n._t=function(t,n,r){for(var i=0,e=t.length;i<e;i++){var a=t[i].data;a.current=!0,this.tileCache.add(t[i].node.id,a)}var u={tiles:t,leaves:n};this.onDrawTileStart(u);var o=r&&r.renderTarget,f=r&&r.sceneFilter;this.painter.paint(t,n,f,o),this.layer.options.debug&&this.painter.paintRegion(t,{color:this.layer.options.debugOutline},f,o),this.onDrawTileEnd(u)},n.onDrawTileStart=function(){},n.onDrawTileEnd=function(){},n.loadTiles=function(t){for(var n=0,r=t.length;n<r;n++){var i=t[n];this.tilesLoading[i.id]={current:!0,node:i},this.loadTile(i)}},n.loadTile=function(n){var r=this,i=n.content.url;n&&-1===i.indexOf("http://")&&-1===i.indexOf("https://")&&(i=n.baseUrl+i);var t=this.layer.options.services[n.ct];if(t.ajaxInMainThread){var e=t.urlParams;e&&(e=(0<i.indexOf("?")?"&":"?")+e);var a=Xt.getArrayBuffer(i+(e||""),t.ajaxOptions),u=a.xhr;a=a.then(function(t){delete r.G[i],t?r.Xt(i,t.data,n):r.onTileError(null,n)}).catch(function(t){delete r.G[i],r.onTileError(t,n)}),this.G[i]=u}else this.Xt(i,null,n)},n.Xt=function(r,t,i){var e=this;this.workerConn.loadTile(this.layer.getId(),{url:r,arraybuffer:t,rootIdx:i.ct,upAxis:i.Dt,transform:i.matrix},function(t,n){t?e.onTileError(t,i):n.gltf?e.painter.createModelMesh(n,i,function(t){t?e.onTileError(t,i):e.onTileLoad(n,i)}):e.onTilesetLoad(n,i,r)})},n.onTileLoad=function(t,n){this.layer&&(delete this.tilesLoading[n.id],this.qt(n),this.setToRedraw(),this.layer.fire("tileload",{node:n}))},n.onTilesetLoad=function(t,n,r){this.layer&&(delete this.tilesLoading[n.id],this.layer.onTilesetLoad(t,n,r))},n.onTileError=function(t,n){if(this.layer){var r=n.content.url;console.warn("failed to load 3d tile: "+r),console.warn(t),delete this.tilesLoading[n.id],this.qt(n),this.setToRedraw(),this.layer.fire("tileerror",{node:n,error:t})}},n.Ot=function(t){return this.tileCache.get(t)},n.qt=function(t){var n={loadTime:E.Util.now(),current:!0,node:t};this.tileCache.add(t.id,n)},n.abortTileLoading=function(t){if(t&&this.workerConn){var n=t.node.content.url;if(this.layer.options.services[t.node.ct].ajaxInMainThread){var r=this.G[n];r&&r.abort()}else this.workerConn.abortTileLoading(this.layer.getId(),n);delete this.G[n]}},n.It=function(){var t=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.tilesLoading[n].current=!1,t++;return t},n.deleteTile=function(t){this.painter.deleteTile(t)},n.createContext=function(){var t=this.layer,n=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:t.options.antialias};this.canvas.gl&&this.canvas.gl.wrap?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):(this.glOptions=n,this.gl=this.Vt(this.canvas,n)),this.regl=this.regl||I.createREGL({gl:this.gl,attributes:n,extensions:["OES_element_index_uint"],optionalExtensions:t.options.glExtensions||[]}),this.painter=new gn(this.regl,t)},n.prepareWorker=function(){var n=this,t=this.getMap();this.workerConn||(this.workerConn=new dn("@maptalks/3dtiles",t.id));var r=this.workerConn;if(r.isActive()){var i=this.layer.options||{},e=this.layer.getId();r.addLayer(e,i,function(t){if(t)throw t;n.layer&&(n.ready=!0,n.layer.fire("workerready"))})}},n.onRemove=function(){this.painter.remove(),this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),function(t){if(t)throw t}),this.workerConn.remove(),delete this.workerConn),this.clear(),delete this.tileCache,r.prototype.onRemove.call(this)},n.clear=function(){this.Ct(!0),this.tileCache.reset(),this.tilesLoading={},r.prototype.clear.call(this)},n.clearCanvas=function(){this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),r.prototype.clearCanvas.call(this)},n.getTileOpacity=function(){return 1},n.getStencilValue=function(){return 0},n.Ct=function(t){this.Bt||(this.Bt=Date.now());var n=Date.now();if(t||!(n-this.Bt<this.layer.options.retireInterval))for(var r in this.Bt=n,this.tilesLoading){var i=this.tilesLoading[r];!t&&i.current||(this.abortTileLoading(i),this.painter.has(i)&&this.painter.deleteTile(i),delete this.tilesLoading[r])}},n.Lt=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit},n.Vt=function(t,n){for(var r=["webgl","experimental-webgl"],i=null,e=0;e<r.length;++e){try{i=t.getContext(r[e],n)}catch(t){}if(i)break}return i},n.Nt=function(t){return!!this.tilesLoading[t]},t}(E.renderer.CanvasRenderer);function On(t,n){return 0===t.node.zt&&0===n.node.zt?n.node.Gt-t.node.Gt:n.node.zt-t.node.zt}function Nn(t,n){return 0===t.zt&&0===n.zt?t.Gt-n.Gt:t.zt-n.zt}var Sn=new Array(3),Un=new Array(3),Rn=[40680631590769,40680631590769,40408299984661.445];function jn(t,n,r,i){var e=Rn,a=Math.cos(r);Sn[0]=a*Math.cos(n),Sn[1]=a*Math.sin(n),Sn[2]=Math.sin(r),Zn(Sn,Sn),A(Un,e,Sn);var u,o,f,s=Math.sqrt(J(Sn,Un));return o=u=Un,f=s,u[0]=o[0]/f,u[1]=o[1]/f,u[2]=o[2]/f,B(Sn,Sn,i),g(t,Un,Sn)}var kn=[1/6378137,1/6378137,1/6356752.314245179],Fn=[1/40680631590769,1/40680631590769,1/40408299984661.445],Pn=new Array(3),Xn=new Array(3),Dn=new Array(3);function qn(t,n){var r=Fn,i=function(t,n,r,i,e){var a=n[0],u=n[1],o=n[2],f=r[0],s=r[1],h=r[2],c=a*a*f*f,v=u*u*s*s,l=o*o*h*h,d=c+v+l,M=Math.sqrt(1/d),w=B(Vn,n,M);if(d<e)return isFinite(M)?w:void 0;var m=i[0],p=i[1],y=i[2],b=Bn;b[0]=w[0]*m*2,b[1]=w[1]*p*2,b[2]=w[2]*y*2;var g,T,A,E,x,_,C,I=(1-M)*Gn(n)/(.5*Gn(b)),L=0;do{var O=-2*(c*((x=(T=1/(1+(I-=L)*m))*T)*T)*m+v*((_=(A=1/(1+I*p))*A)*A)*p+l*((C=(E=1/(1+I*y))*E)*E)*y);L=(g=c*x+v*_+l*C-1)/O}while(Math.abs(g)>zn);return t[0]=a*T,t[1]=u*A,t[2]=o*E,t}(Pn,n,kn,r,.1),e=W(Xn,i,r);e=Zn(e,e);var a=K(Dn,n,i),u=Math.atan2(e[1],e[0]),o=Math.asin(e[2]),f=s(J(a,n))*Gn(a);return t[0]=D(u),t[1]=D(o),t[2]=f,t}var Vn=new Array(3),Bn=new Array(3),zn=1e-12;function Gn(t){return w(t)}function Zn(t,n){var r=n[0],i=n[1],e=n[2],a=r*r+i*i+e*e;return 0<a&&(a=Math.sqrt(a),t[0]=n[0]/a,t[1]=n[1]/a,t[2]=n[2]/a),t}var Hn=Object.freeze({__proto__:null,radianToCartesian3:jn,cartesian3ToDegree:qn,normalizeCartesian:Zn});function Jn(t,n,r){return t[0]=n[r],t[1]=n[r+3],t[2]=n[r+6],t}function Yn(t,n,r){return Math.sqrt(function(t,n,r){var i=T(Qn,r,t),e=Jn(Kn,n,0),a=Jn(Wn,n,1),u=Jn($n,n,2),o=rt(e),f=rt(a),s=rt(u);H(e,e),H(a,a),H(u,u);var h=tr;h.x=J(i,e),h.y=J(i,a),h.z=J(i,u);var c,v=0;h.x<-o?(c=h.x+o,v+=c*c):h.x>o&&(c=h.x-o,v+=c*c);h.y<-f?(c=h.y+f,v+=c*c):h.y>f&&(c=h.y-f,v+=c*c);h.z<-s?(c=h.z+s,v+=c*c):h.z>s&&(c=h.z-s,v+=c*c);return v}(t,n,r))}var Qn=[],Kn=[],Wn=[],$n=[],tr=[];var nr=E.projection.EPSG3857,rr=new E.Extent(0,0,0,0),ir=function(i){function t(t,n){var r;return(r=i.call(this,t,n)||this).Zt(),r.G={},r.Ht={},r}e(t,i);var n=t.prototype;return n.Zt=function(){var t=this.options.services.map(function(t){return t.url});this.Jt=t.map(function(t,n){return i=n,{baseUrl:(r=f(r=t)).substring(0,r.lastIndexOf("/"))+"/",content:{url:r},refine:"replace",matrix:I.mat4.identity([]),ct:i,kt:0};var r,i}),this.fire("rootready",{roots:this.Jt.slice(0)})},n.getRootTiles=function(){return this.Jt},n.getTiles=function(){return this.getRenderer().ready?this.Yt():(this.Qt(),{tiles:null})},n.Yt=function(){var t,n,r,i,e=this.getMap(),a=e.cameraPosition,u=e.pointToCoord(new E.Coordinate(a),e.getGLZoom());this.Kt=[X(u.x),X(u.y),e.pointToDistance(a[2],0,e.getGLZoom())],this.Wt=jn(this.Wt||[],this.Kt[0],this.Kt[1],this.Kt[2]),this.$t=2*Math.tan(.5*X(e.getFov())),this.tn=(t=u,n=nr.locate(t,100,0),r=nr.project(t),(i=nr.project(n))._sub(r)._abs(),i.x/100),this.nn=nr.project(u).toArray();for(var o=e.projViewMatrix,f={children:[],level:-1},s=f,h=1/0,c={},v=0;v<this.Jt.length;v++)for(var l=[this.Jt[v]],d=this.rn(v);0<l.length;){var M=l.pop();for(this.in(M);s.level>=M.kt;)s=s.parent;if(this.en(M,d,o)<1){for(var w=s;w&&!w.content;)w=w.parent;w&&w.content&&(c[(M.an=w).node.id]=w)}else{M.content&&M.kt<=h&&(h=M.kt),M.zt<1/0&&this.un(M);var m=this.Pt(M,s);s.children.push(m);var p=M.children,y=p&&p.length,b=m.content;if(!y&&b&&(c[m.node.id]=m),y){b&&"add"===M.refine&&(c[m.node.id]=m),s=m;for(var g=0,T=p.length;g<T;g++){if(!p[g].parent){p[g].parent=M,p[g].Dt=M.Dt,p[g].baseUrl=M.baseUrl;var A=p[g].content&&(p[g].content.url||p[g].content.uri);A&&(p[g].content.url=M.baseUrl+A)}l.push(p[g])}}}}return{root:f,tiles:c}},n.Pt=function(t,n){return{id:t.id,node:t,children:[],level:t.kt,parent:n,content:this.Ft(t)}},n.in=function(t){void 0===t.id&&(t.id=E.Util.GUID(),t.matrix=t.transform||I.mat4.identity([]),t.sn=this.hn(t),t.parent&&(t.matrix=I.mat4.multiply(t.matrix,t.parent.matrix,t.matrix),t.ct=t.parent.ct,void 0===t.kt&&(t.kt=t.parent.kt+1),t.maxExtent=t.parent.maxExtent),t.refine=t.refine&&t.refine.toLowerCase()||"replace",t.content&&!t.content.url&&t.content.uri&&(t.content.url=t.content.uri))},n.hn=function(t){return void 0===t.geometricError||!t.boundingVolume},n.Ft=function(t){return t.content&&t.content.url},n.un=function(t){for(var n=t.parent;n&&n.sn&&!(n.zt<=t.zt&&n.Gt<=t.Gt);)n.zt=t.zt,n.Gt=t.Gt,n=t.parent},n.onTilesetLoad=function(t,n,r){if(t){var i=this.options.services[n.ct].upAxis||t.asset&&t.asset.gltfUpAxis||n&&n.Dt||"Y";if(t.root.baseUrl=r.substring(0,r.lastIndexOf("/")+1),t.root.Dt=i,n){var e=n.boundingVolume;o(n,t.root),n.boundingVolume=e;var a=t.root.transform;a&&(n.parent?n.matrix=I.mat4.multiply([],n.parent.matrix,a):n.matrix=a),n.children&&n.children.length&&(delete n.content,t.root.content&&(n.content=t.root.content)),n.sn=this.hn(n);var u=n.content&&(n.content.url||n.content.uri);u&&-1===u.indexOf("http://")&&-1===u.indexOf("https://")&&(n.content.url=n.baseUrl+u)}this.Qt(),this.fire("loadtileset",{tileset:t})}else console.warn("invalid tileset at : "+r)},n.en=function(t,n,r){if(t.zt=1/0,0===t.kt||t.sn)return 1;if(t.cn=1/0,!this.vn(t,n,r))return-1;var i=this.options.services[t.ct].maximumScreenSpaceError;null==i&&(i=8);var e=this.ln(t);return 0===e&&t.parent&&(e=.5*t.parent.cn),i<=e?1:0},n.vn=function(t,n,r){var i=this.getMap();if(!i)return!1;var e=t.id,a=this.Ht[e];if(!t.boundingVolume)return!1;var u,o,f,s=i.getGLZoom();if(!a&&(t.boundingVolume&&!a))if(t.boundingVolume.region){var h=t.boundingVolume.region;u=(u=new E.Extent(D(h[0]),D(h[1]),D(h[2]),D(h[3]))).convertTo(function(t){return i.coordToPoint(t,s)}),f=h[4],o=h[5],a=this.Ht[e]=[[u.xmin,u.ymin,f,f],[u.xmax,u.ymax,o,o]]}else if(t.boundingVolume.sphere){var c=t.boundingVolume.sphere,v=qn([],I.vec3.transformMat4(c,c,t.matrix)),l=i.coordToPoint(new E.Coordinate(v),s).toArray();l.push(v[2],v[2]),a=this.Ht[e]=[l,c[3],c[3]]}else if(t.boundingVolume.box){var d=t.boundingVolume.box,M=qn([],I.vec3.transformMat4(d,d,t.matrix)),w=i.coordToPoint(new E.Coordinate(M),s).toArray();w.push(M[2]);var m=d.slice(3);I.mat3.multiply(m,I.mat3.fromMat4([],t.matrix),m);for(var p=0;p<m.length;p++)d[3+p]=m[p];a=this.Ht[e]=[[].concat(w,m),[].concat(w,m)]}var y=this.tn/i.getResolution(s);if(n){if(t.boundingVolume.region)rr.xmin=a[0][0],rr.ymin=a[0][1],rr.xmax=a[1][0],rr.ymax=a[1][1];else if(t.boundingVolume.sphere){var b=a[2]*y;rr.xmin=a[0][0]-b,rr.ymin=a[0][1]-b,rr.xmax=a[0][0]+b,rr.ymax=a[0][1]+b}else if(t.boundingVolume.box){var g=a[1]*y,T=a[2]*y;rr.xmin=a[0][0]-g,rr.ymin=a[0][1]-T,rr.xmax=a[0][0]+g,rr.ymax=a[0][1]+T}if(!n.intersects(rr))return!1}if(t.boundingVolume.region)return a[0][2]=a[0][3]*y,a[1][2]=a[1][3]*y,_(r,a);if(t.boundingVolume.sphere)return a[0][2]=a[0][3]*y,a[1]=a[2]*y,function(t,n,r){F(t);for(var i=n[0],e=-n[1],a=0;a<6;a++)if((!r||"0"!==r.charAt(a))&&P(x[a],i)<e)return!1;return!0}(r,a);if(t.boundingVolume.box){for(var A=2;A<a[1].length;A++)a[0][A]=a[1][A]*y;return function(t,n,r){F(t);for(var i=0;i<6;i++)if((!r||"0"!==r.charAt(i))&&(e=x[i],void 0,u=(a=n).slice(0,3),o=e,f=a.slice(3),s=o[0],h=o[1],c=o[2],v=Math.abs(s*f[C]+h*f[L]+c*f[O])+Math.abs(s*f[N]+h*f[S]+c*f[U])+Math.abs(s*f[R]+h*f[j]+c*f[k]),P(e,u)<=-v))return!1;var e,a,u,o,f,s,h,c,v;return!0}(r,a[0])}return!1},n.rn=function(t){var n=this.options.services[t].maxExtent;if(!n)return null;var r=this.Jt[t];if(r.maxExtent)return r.maxExtent;var i=this.getMap(),e=i.getGLZoom();return r.maxExtent=new E.Extent(n).convertTo(function(t){return i.coordToPoint(t,e)}),r.maxExtent},n.ln=function(t){var n=this.$t,r=t.geometricError;if(0===r)return 0;var i,e,a,u,o,f,s,h,c,v,l,d,M,w,m,p,y,b,g,T,A,E,x=this.getMap();t.boundingVolume.region?(i=function(t,n,r,i){var e=t.boundingVolume.region,a=t.dn;a||(a=t.dn=[ur(e[0],e[1]),ur(e[0],e[3]),ur(e[2],e[1]),ur(e[2],e[3]),ur(e[0],e[1]),ur(e[0],e[3]),ur(e[2],e[1]),ur(e[2],e[3])],t.Mn=[Math.min.apply(Math,a.map(function(t){return t[0]})),Math.min.apply(Math,a.map(function(t){return t[1]}))],t.wn=[Math.max.apply(Math,a.map(function(t){return t[0]})),Math.max.apply(Math,a.map(function(t){return t[1]}))]);if(r[0]>=e[0]&&r[0]<=e[2]&&r[1]>=e[1]&&r[1]<=e[3])return r[2]<=e[5]?0:r[2]-e[5];var u=(f=t.Mn,s=t.wn,h=n,c=Math.max(f[0]-h[0],0,h[0]-s[0]),v=Math.max(f[1]-h[1],0,h[1]-s[1]),Math.sqrt(c*c+v*v)/i),o=0;var f,s,h,c,v;r[2]>e[5]&&(o=r[2]-e[5]);return Math.sqrt(u*u+o*o)}(t,this.nn,this.Kt,this.tn),y=t,b=this.Wt,g=y.boundingVolume.region,T=jn(er,g[0],g[1],g[4]),A=jn(ar,g[2],g[3],g[5]),E=I.vec3.scale(T,I.vec3.add(T,T,A),.5),e=I.vec3.dist(E,b)):t.boundingVolume.sphere?(d=t,M=this.Wt,w=d.boundingVolume.sphere,m=I.vec3.dist(w,M),p=d.boundingVolume.sphere[3],i=m<p?0:m-p,c=t,v=this.Wt,l=c.boundingVolume.sphere,e=I.vec3.dist(l,v)):t.boundingVolume.box&&(f=t,s=this.Wt,i=Yn((h=f.boundingVolume.box).slice(0,3),h.slice(3),s),a=t,u=this.Wt,o=a.boundingVolume.box,e=I.vec3.dist(o,u));var _=Math.max(Math.abs(i),1e-7),C=r*x.height/(_*n);return t.zt=i,t.Gt=e,t.cn=C},n.Qt=function(){var t=this.getRenderer();t&&t.setToRedraw()},t}(E.Layer);ir.mergeOptions({maxCacheSize:500,retireInterval:2e3,loadingLimitOnInteracting:5,loadingLimit:0,renderer:"gl",forceRenderOnZooming:!0,forceRenderOnRotating:!0,forceRenderOnMoving:!0,debug:!1,debugOutline:[0,1,0],antialias:!1,sRGBTolinear:!1}),ir.registerRenderer("gl",Ln);var er=[],ar=[];function ur(t,n){var r=new E.Coordinate(D(t),D(n));return nr.project(r).toArray()}var or=function(){function t(t){this.u=t}t.createEmptyB3DM=function(){return{featureTable:null,batchTable:null,gltf:{}}};var n=t.prototype;return n.load=function(r,t){var i=this;return t?this.X(r,t):Xt.getArrayBuffer(r,{}).then(function(t){var n=t.data;return i.X(r,n)})},n.X=function(t,n){var r=this.D(n),i=t.substring(0,t.lastIndexOf("/")),e=new cn(i,r.glb,{requestImage:this.u});return e.load().then(function(t){return{transferables:e.transferables,featureTable:r.featureTable,batchTable:r.batchTable,gltf:t}})},n.D=function(t){var n,r=new DataView(t),i=r.getUint32(4,!0);if(1!==i)throw new Error("Unsupported b3dm version : "+i);if(r.getUint32(8,!0)!==t.byteLength)throw new Error("Length in b3dm header is inconsistent with b3dm's byte length.");for(var e=20;e<t.byteLength;){if(1179937895===r.getUint32(e,!0)){n=e;break}e+=4}return{glb:{buffer:t,byteOffset:n}}},n.q=function(){return null},n.V=function(){return null},t}();t.B3DMLoader=or,t.Geo3DTilesLayer=ir,t.Geo3DTilesUtil=r,t.Geo3DTransform=Hn,Object.defineProperty(t,"Y",{value:!0})}),"undefined"!=typeof console&&console.log("@maptalks/3dtiles v0.3.2")});
